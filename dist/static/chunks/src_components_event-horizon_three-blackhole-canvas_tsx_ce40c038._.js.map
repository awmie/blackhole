{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/awmie/blackhole/src/components/event-horizon/three-blackhole-canvas.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useRef, useEffect, useCallback } from 'react';\nimport type * as THREE_TYPE from 'three';\nimport type { OrbitControls as OrbitControlsType } from 'three/examples/jsm/controls/OrbitControls.js';\nimport type { EffectComposer as EffectComposerType } from 'three/examples/jsm/postprocessing/EffectComposer.js';\nimport type { RenderPass as RenderPassType } from 'three/examples/jsm/postprocessing/RenderPass.js';\nimport type { ShaderPass as ShaderPassType } from 'three/examples/jsm/postprocessing/ShaderPass.js';\nimport type { PlanetState, CollisionEvent } from '@/app/page';\n\n// Gravitational Constants (tune these for desired simulation behavior)\nconst G_CONSTANT = 0.05; // Gravitational constant\nconst BLACK_HOLE_MASS_EQUIVALENT_FACTOR = 200; // Multiplied by radius for mass\nconst STAR_BASE_MASS = 150; // Base mass for a star of scale 1\nconst PLANET_BASE_MASS = 0.5;  // Base mass for a planet of scale 1\nconst MIN_GRAVITY_DISTANCE_SQ = 0.01; // To prevent division by zero / extreme forces\n\nexport interface JetParticleState {\n  id: number;\n  position: THREE_TYPE.Vector3;\n  velocity: THREE_TYPE.Vector3;\n  life: number;\n  initialLife: number;\n  color: THREE_TYPE.Color;\n  size: number;\n  active: boolean;\n}\n\ninterface EvolvingObjectData { // Renamed from EvolvingPlanetData\n  id: number;\n  velocity: THREE_TYPE.Vector3; // Now stores full velocity vector\n  position: THREE_TYPE.Vector3; // Stores current position\n  ttl: number; // Time to live\n  // Removed angle, radius as primary dynamic properties; position is key\n}\n\ninterface StarEmittedParticleState {\n  id: number;\n  position: THREE_TYPE.Vector3;\n  velocity: THREE_TYPE.Vector3;\n  life: number;\n  initialLife: number;\n  color: THREE_TYPE.Color;\n  size: number;\n  active: boolean;\n}\n\nexport interface ShatterParticleState {\n  id: number;\n  position: THREE_TYPE.Vector3;\n  velocity: THREE_TYPE.Vector3;\n  life: number;\n  initialLife: number;\n  color: THREE_TYPE.Color;\n  size: number;\n  active: boolean;\n}\n\n\ninterface ThreeBlackholeCanvasProps {\n  blackHoleRadius: number;\n  accretionDiskInnerRadius: number;\n  accretionDiskOuterRadius: number;\n  accretionDiskOpacity: number;\n  onCameraUpdate: (position: { x: number; y: number; z: number }) => void;\n  spawnedPlanets: PlanetState[]; // \"Planets\" here means any spawned celestial object\n  onAbsorbPlanet: (id: number) => void;\n  onSetPlanetDissolving: (id: number, dissolving: boolean) => void;\n  isEmittingJets: boolean;\n  onCameraReady?: (camera: THREE_TYPE.PerspectiveCamera) => void;\n  onShiftClickSpawnAtPoint?: (position: THREE_TYPE.Vector3) => void;\n  onStarMassLoss?: (starId: number, massLossAmount: number) => void;\n  onUpdatePlanetPosition?: (objectId: number, position: { x: number, y: number, z: number }, velocity: { x: number, y: number, z: number }) => void;\n  collisionEvents: CollisionEvent[];\n  onCollisionEventProcessed: (eventId: string) => void;\n  simulationSpeed: number;\n}\n\nconst NUM_DISK_PARTICLES = 25000; // Optimized: reduced from 50000 for better performance while maintaining visual quality\nconst baseAngularSpeed = 1.0; // For accretion disk particles only\nconst minAngularSpeedFactor = 0.02; // For accretion disk particles only\nconst photonRingThreshold = 0.03;\n\nconst PULL_IN_FACTOR_DISSOLVING_BH = 8.0; // Stronger pull specifically for BH when dissolving\nconst DISSOLUTION_START_RADIUS_FACTOR = 1.2; // When an object gets this close to BH (factor of BH radius)\nconst DISSOLUTION_DURATION = 1.5; // Default time to dissolve once triggered\n\ninterface DiskParticleData { // For accretion disk only\n  radius: number;\n  angle: number;\n  angularVelocity: number;\n  yOffset: number;\n}\n\nconst blackHoleVertexShader = `\nvarying vec3 v_worldPosition;\nvarying vec3 v_normal;\nvarying vec4 v_screenPosition; \n\nvoid main() {\n  vec4 worldPos = modelMatrix * vec4(position, 1.0);\n  v_worldPosition = worldPos.xyz;\n  v_normal = normalize(mat3(modelMatrix) * normal);\n  \n  v_screenPosition = projectionMatrix * modelViewMatrix * vec4(position, 1.0); \n  \n  gl_Position = v_screenPosition;\n}\n`;\n\nconst blackHoleFragmentShader = `\nvarying vec3 v_worldPosition;\nvarying vec3 v_normal;\nvarying vec4 v_screenPosition;\n\nuniform vec3 u_cameraPosition;\n\nvoid main() {\n  // Simple black hole - just black with fresnel edge\n  vec3 normal = normalize(v_normal);\n  vec3 viewDir = normalize(u_cameraPosition - v_worldPosition);\n  float fresnel = pow(1.0 - abs(dot(normal, viewDir)), 2.0);\n  \n  gl_FragColor = vec4(vec3(0.0), 1.0);\n}\n`;\n\nconst JET_PARTICLE_COUNT = 10000; \nconst JET_LIFESPAN = 4.0; \nconst JET_SPEED = 6;\nconst JET_PARTICLE_BASE_SIZE = 0.003; \nconst JET_SPREAD_ANGLE = Math.PI / 16384; \nconst JET_VELOCITY_RANDOM_OFFSET_MAGNITUDE = 0.0005; \nconst JET_EMIT_BURST_COUNT = 150; \n\nconst STAR_EMITTED_PARTICLE_COUNT = 10000;\nconst STAR_DISSOLUTION_EMIT_RATE_PER_FRAME = 2;\nconst STAR_DISSOLUTION_PARTICLE_LIFESPAN = 1.5;\nconst STAR_DISSOLUTION_PARTICLE_INITIAL_SPEED = 0.3;\nconst STAR_DISSOLUTION_PARTICLE_GRAVITY_FACTOR = 0.5;\n\n\nconst SHATTER_PARTICLE_POOL_SIZE = 5000;\nconst SHATTER_PARTICLES_PER_COLLISION = 75;\nconst SHATTER_PARTICLE_LIFESPAN_MIN = 0.8;\nconst SHATTER_PARTICLE_LIFESPAN_MAX = 1.8;\nconst SHATTER_PARTICLE_SPEED_MIN = 0.5;\nconst SHATTER_PARTICLE_SPEED_MAX = 2.5;\nconst SHATTER_PARTICLE_SIZE_MIN = 0.0008;\nconst SHATTER_PARTICLE_SIZE_MAX = 0.002;\n\nconst SHATTER_PARTICLE_GRAVITY_FACTOR_BASE = 0.02; \nconst SHATTER_PARTICLE_NEAR_BH_THRESHOLD_FACTOR = 4.0; \nconst SHATTER_PARTICLE_GRAVITY_BOOST_NEAR_BH = 25.0; \nconst SHATTER_PARTICLE_SPIRAL_STRENGTH_NEAR_BH = 0.3; \nconst SHATTER_PARTICLE_QUICK_ABSORPTION_RADIUS_FACTOR = 1.1; \nconst SHATTER_PARTICLE_LIFESPAN_REDUCTION_NEAR_ABSORPTION = 8.0;\n\nconst NUM_BACKGROUND_STARS = 20000; // Optimized: reduced from 30000 for better performance while maintaining visual depth\n\n// Lensing Shader for post-processing\nconst LensingShader = {\n  uniforms: {\n    tDiffuse: { value: null as unknown as THREE_TYPE.Texture },\n    resolution: { value: null as unknown as THREE_TYPE.Vector2 },\n    bhPos: { value: null as unknown as THREE_TYPE.Vector2 },\n    bhRadius: { value: 0.0 },\n    mass: { value: 0.0 },\n  },\n  vertexShader: `\n    varying vec2 vUv;\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  `,\n  fragmentShader: `\n    uniform sampler2D tDiffuse;\n    uniform vec2 resolution;\n    uniform vec2 bhPos;\n    uniform float bhRadius;\n    uniform float mass;\n    varying vec2 vUv;\n    \n    void main() {\n      vec2 aspectUv = vUv * vec2(resolution.x / resolution.y, 1.0);\n      vec2 aspectBh = bhPos * vec2(resolution.x / resolution.y, 1.0);\n      \n      vec2 toBh = aspectBh - aspectUv;\n      float dist = length(toBh);\n      \n      // Normalize distance by black hole radius\n      float r = dist / max(bhRadius, 0.001);\n      \n      // Define the lensing influence radius (how far the effect reaches)\n      float influenceRadius = 4.0; // Only lens within 4x the black hole radius\n      \n      // Smooth falloff: 1.0 at center, 0.0 at influenceRadius\n      float falloff = 1.0 - smoothstep(0.0, influenceRadius, dist);\n      \n      // Einstein radius is where light from behind gets bent around\n      float einsteinR = 1.5;\n      \n      // Gravitational deflection: stronger near the black hole\n      float deflection = 3.0 / (r + 0.1);\n      deflection = min(deflection, 5.0);\n      \n      // Apply falloff so lensing fades to zero far from black hole\n      deflection *= falloff;\n      \n      // Extra boost at Einstein radius for the ring effect\n      float ringDist = abs(r - einsteinR);\n      float nearEinstein = smoothstep(0.8, 0.0, ringDist) * falloff;\n      deflection += nearEinstein * 2.0;\n      \n      vec2 offset = normalize(toBh) * deflection * bhRadius * 0.5;\n      offset.x /= resolution.x / resolution.y;\n      \n      // Sample the background with displacement\n      vec4 color = texture2D(tDiffuse, vUv + offset);\n      \n      // Black hole shadow - completely black inside event horizon\n      if (dist < bhRadius) {\n        color = vec4(0.0, 0.0, 0.0, 1.0);\n      } else {\n        // Brighten the Einstein ring where the bent accretion disk appears\n        float ringIntensity = exp(-ringDist * ringDist * 8.0) * 1.5 * falloff;\n        color.rgb *= 1.0 + ringIntensity;\n        \n        // Slight warm tint in the ring from the accretion disk\n        vec3 diskColor = vec3(1.0, 0.8, 0.4);\n        color.rgb = mix(color.rgb, diskColor, ringIntensity * 0.3);\n      }\n      \n      gl_FragColor = color;\n    }\n  `\n};\n\ninterface StarTwinkleData {\n    initialSize: number;\n    phase: number;\n    speed: number;\n}\n\nconst ThreeBlackholeCanvas: React.FC<ThreeBlackholeCanvasProps> = ({\n  blackHoleRadius,\n  accretionDiskInnerRadius,\n  accretionDiskOuterRadius,\n  accretionDiskOpacity,\n  onCameraUpdate,\n  spawnedPlanets,\n  onAbsorbPlanet,\n  onSetPlanetDissolving,\n  isEmittingJets,\n  onCameraReady,\n  onShiftClickSpawnAtPoint,\n  onStarMassLoss,\n  onUpdatePlanetPosition,\n  collisionEvents,\n  onCollisionEventProcessed,\n  simulationSpeed,\n}) => {\n  const mountRef = useRef<HTMLDivElement>(null);\n  const rendererRef = useRef<THREE_TYPE.WebGLRenderer | null>(null);\n  \n  const foregroundSceneRef = useRef<THREE_TYPE.Scene | null>(null);\n  const backgroundSceneRef = useRef<THREE_TYPE.Scene | null>(null); \n\n  const cameraRef = useRef<THREE_TYPE.PerspectiveCamera | null>(null);\n  const controlsRef = useRef<OrbitControlsType | null>(null);\n\n  const composerRef = useRef<EffectComposerType | null>(null);\n  const lensingPassRef = useRef<ShaderPassType | null>(null);\n\n  const blackHoleRef = useRef<THREE_TYPE.Mesh | null>(null);\n  const blackHoleMaterialRef = useRef<THREE_TYPE.ShaderMaterial | null>(null);\n  const accretionDiskRef = useRef<THREE_TYPE.Points | null>(null);\n  const starsRef = useRef<THREE_TYPE.Points | null>(null); \n  const starTwinkleDataRef = useRef<StarTwinkleData[]>([]);\n\n\n  const clockRef = useRef<THREE_TYPE.Clock | null>(null);\n  const diskParticleDataRef = useRef<DiskParticleData[]>([]); // Accretion disk specific\n  const celestialObjectsRef = useRef<Map<number, THREE_TYPE.Object3D>>(new Map()); // Renamed from planetMeshesRef\n  const dissolvingObjectsProgressRef = useRef<Map<number, number>>(new Map());\n  const evolvingObjectDataRef = useRef<Map<number, EvolvingObjectData>>(new Map()); // Renamed\n\n  const jetParticlesRef = useRef<THREE_TYPE.Points | null>(null);\n  const jetParticleDataRef = useRef<JetParticleState[]>([]);\n  const jetMaterialRef = useRef<THREE_TYPE.PointsMaterial | null>(null);\n  const lastJetParticleIndexRef = useRef(0);\n\n  const starEmittedParticlesRef = useRef<THREE_TYPE.Points | null>(null);\n  const starEmittedParticleDataRef = useRef<StarEmittedParticleState[]>([]);\n  const starEmittedParticleMaterialRef = useRef<THREE_TYPE.PointsMaterial | null>(null);\n  const lastStarEmittedParticleIndexRef = useRef(0);\n\n  const shatterParticlesRef = useRef<THREE_TYPE.Points | null>(null);\n  const shatterParticleDataRef = useRef<ShatterParticleState[]>([]);\n  const shatterParticleMaterialRef = useRef<THREE_TYPE.PointsMaterial | null>(null);\n  const lastShatterParticleIndexRef = useRef(0);\n\n\n  const sceneCaptureRenderTargetRef = useRef<THREE_TYPE.WebGLRenderTarget | null>(null); \n  const tempVectorRef = useRef<THREE_TYPE.Vector3 | null>(null);\n  const tempVector2Ref = useRef<THREE_TYPE.Vector3 | null>(null); // For gravity calculations\n  const tempQuaternionRef = useRef<THREE_TYPE.Quaternion | null>(null);\n\n\n  const THREEInstanceRef = useRef<typeof THREE_TYPE | null>(null);\n\n  const onShiftClickSpawnAtPointRef = useRef(onShiftClickSpawnAtPoint);\n  const onCameraUpdateRef = useRef(onCameraUpdate);\n  const onAbsorbPlanetRef = useRef(onAbsorbPlanet);\n  const onSetPlanetDissolvingRef = useRef(onSetPlanetDissolving);\n  const onStarMassLossRef = useRef(onStarMassLoss);\n  const onUpdatePlanetPositionRef = useRef(onUpdatePlanetPosition);\n  const collisionEventsRef = useRef(collisionEvents);\n  const onCollisionEventProcessedRef = useRef(onCollisionEventProcessed);\n\n\n  const spawnedObjectsRef_anim = useRef(spawnedPlanets); // Renamed from spawnedPlanetsRef_anim\n  useEffect(() => { spawnedObjectsRef_anim.current = spawnedPlanets; }, [spawnedPlanets]);\n\n  const isEmittingJetsRef_anim = useRef(isEmittingJets);\n  useEffect(() => { isEmittingJetsRef_anim.current = isEmittingJets; }, [isEmittingJets]);\n\n  const blackHoleRadiusRef_anim = useRef(blackHoleRadius);\n  useEffect(() => { blackHoleRadiusRef_anim.current = blackHoleRadius; }, [blackHoleRadius]);\n  \n  const simulationSpeedRef_anim = useRef(simulationSpeed);\n  useEffect(() => { simulationSpeedRef_anim.current = simulationSpeed; }, [simulationSpeed]);\n\n\n  useEffect(() => { onShiftClickSpawnAtPointRef.current = onShiftClickSpawnAtPoint; }, [onShiftClickSpawnAtPoint]);\n  useEffect(() => { onCameraUpdateRef.current = onCameraUpdate; }, [onCameraUpdate]);\n  useEffect(() => { onAbsorbPlanetRef.current = onAbsorbPlanet; }, [onAbsorbPlanet]);\n  useEffect(() => { onSetPlanetDissolvingRef.current = onSetPlanetDissolving; }, [onSetPlanetDissolving]);\n  useEffect(() => { onStarMassLossRef.current = onStarMassLoss; }, [onStarMassLoss]);\n  useEffect(() => { onUpdatePlanetPositionRef.current = onUpdatePlanetPosition; }, [onUpdatePlanetPosition]);\n  useEffect(() => { collisionEventsRef.current = collisionEvents; }, [collisionEvents]);\n  useEffect(() => { onCollisionEventProcessedRef.current = onCollisionEventProcessed; }, [onCollisionEventProcessed]);\n\n\n  const createAndAddAccretionParticles = useCallback((\n    innerR: number,\n    outerR: number,\n    opacity: number\n  ) => {\n    const THREE = THREEInstanceRef.current;\n    const scene = foregroundSceneRef.current; \n    if (!THREE || !scene) return;\n\n    if (accretionDiskRef.current) {\n      scene.remove(accretionDiskRef.current);\n      accretionDiskRef.current.geometry.dispose();\n      (accretionDiskRef.current.material as THREE_TYPE.Material).dispose();\n      accretionDiskRef.current = null;\n    }\n\n    const particlesGeometry = new THREE.BufferGeometry();\n    const positions = new Float32Array(NUM_DISK_PARTICLES * 3);\n    const colors = new Float32Array(NUM_DISK_PARTICLES * 4);\n    diskParticleDataRef.current = [];\n\n    const colorInner = new THREE.Color(1.0, 0.4, 0.8);\n    const colorMid = new THREE.Color(0.6, 0.3, 0.9);\n    const colorOuter = new THREE.Color(0.2, 0.1, 0.7);\n    const colorPhotonRing = new THREE.Color(1.0, 0.95, 0.85);\n    const outerFadeStartNormalized = 0.7;\n\n    for (let i = 0; i < NUM_DISK_PARTICLES; i++) {\n      const i3 = i * 3;\n      const i4 = i * 4;\n      const radius = Math.random() * (outerR - innerR) + innerR;\n      const angle = Math.random() * Math.PI * 2;\n      const yOffset = (Math.random() - 0.5) * 0.1;\n\n      let normalizedDist = (radius - innerR) / (outerR - innerR);\n      normalizedDist = Math.max(0, Math.min(1, normalizedDist));\n\n      let angularVelocity = baseAngularSpeed * Math.pow(innerR / radius, 2.5);\n      angularVelocity = Math.max(angularVelocity, baseAngularSpeed * minAngularSpeedFactor);\n\n      diskParticleDataRef.current.push({ radius, angle, angularVelocity, yOffset });\n\n      positions[i3] = radius * Math.cos(angle);\n      positions[i3 + 1] = yOffset;\n      positions[i3 + 2] = radius * Math.sin(angle);\n\n      const particleColor = new THREE.Color();\n      if (normalizedDist < 0.5) {\n        particleColor.lerpColors(colorInner, colorMid, normalizedDist * 2.0);\n      } else {\n        particleColor.lerpColors(colorMid, colorOuter, (normalizedDist - 0.5) * 2.0);\n      }\n\n      if (normalizedDist < photonRingThreshold) {\n        let photonRingIntensity = (photonRingThreshold - normalizedDist) / photonRingThreshold;\n        photonRingIntensity = Math.pow(photonRingIntensity, 1.5);\n        particleColor.lerp(colorPhotonRing, photonRingIntensity);\n        particleColor.r = Math.min(1.0, particleColor.r + photonRingIntensity * 2.5);\n        particleColor.g = Math.min(1.0, particleColor.g + photonRingIntensity * 2.5);\n        particleColor.b = Math.min(1.0, particleColor.b + photonRingIntensity * 2.5);\n      } else {\n        const innerEdgeFactor = 1.0 - Math.min(1.0, Math.max(0.0, (normalizedDist - photonRingThreshold) / 0.15));\n         if (innerEdgeFactor > 0) {\n            particleColor.r = Math.min(1.0, particleColor.r + innerEdgeFactor * 0.8);\n            particleColor.g = Math.min(1.0, particleColor.g + innerEdgeFactor * 0.8);\n            particleColor.b = Math.min(1.0, particleColor.b + innerEdgeFactor * 0.8);\n        }\n      }\n\n      colors[i4] = particleColor.r;\n      colors[i4 + 1] = particleColor.g;\n      colors[i4 + 2] = particleColor.b;\n\n      let particleAlpha = opacity;\n      if (normalizedDist > outerFadeStartNormalized) {\n        particleAlpha *= (1.0 - (normalizedDist - outerFadeStartNormalized) / (1.0 - outerFadeStartNormalized));\n      }\n      colors[i4 + 3] = Math.max(0.0, Math.min(1.0, particleAlpha));\n    }\n\n    particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));\n    particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 4));\n\n    const particlesMaterial = new THREE.PointsMaterial({\n      size: 0.01,\n      vertexColors: true,\n      transparent: true,\n      blending: THREE.AdditiveBlending,\n      depthWrite: false,\n      sizeAttenuation: true,\n    });\n\n    const newDisk = new THREE.Points(particlesGeometry, particlesMaterial);\n    scene.add(newDisk);\n    accretionDiskRef.current = newDisk;\n  }, []);\n\n  const initJetParticles = useCallback(() => {\n    const THREE = THREEInstanceRef.current;\n    const scene = foregroundSceneRef.current; \n    if (!THREE || !scene) return;\n\n    if (jetParticlesRef.current) {\n        scene.remove(jetParticlesRef.current);\n        jetParticlesRef.current.geometry.dispose();\n        if (jetParticlesRef.current.material instanceof THREE.Material) {\n             (jetParticlesRef.current.material as THREE_TYPE.Material).dispose();\n        }\n        jetParticlesRef.current = null;\n    }\n\n    const geometry = new THREE.BufferGeometry();\n    const positions = new Float32Array(JET_PARTICLE_COUNT * 3);\n    const colorsAttribute = new Float32Array(JET_PARTICLE_COUNT * 3);\n    const sizesAttribute = new Float32Array(JET_PARTICLE_COUNT);\n\n\n    jetParticleDataRef.current = [];\n    for (let i = 0; i < JET_PARTICLE_COUNT; i++) {\n        jetParticleDataRef.current.push({\n            id: i,\n            position: new THREE.Vector3(0, -1000, 0), \n            velocity: new THREE.Vector3(),\n            life: 0,\n            initialLife: JET_LIFESPAN,\n            color: new THREE.Color(1,1,1),\n            size: JET_PARTICLE_BASE_SIZE,\n            active: false,\n        });\n        positions[i*3] = 0; positions[i*3+1] = -1000; positions[i*3+2] = 0;\n        colorsAttribute[i*3] = 1; colorsAttribute[i*3+1] = 1; colorsAttribute[i*3+2] = 1;\n        sizesAttribute[i] = JET_PARTICLE_BASE_SIZE;\n    }\n\n    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));\n    geometry.setAttribute('color', new THREE.Float32BufferAttribute(colorsAttribute, 3));\n    geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizesAttribute, 1));\n\n    jetMaterialRef.current = new THREE.PointsMaterial({\n        vertexColors: true,\n        transparent: true,\n        blending: THREE.AdditiveBlending,\n        depthWrite: false,\n        sizeAttenuation: true, \n    });\n\n    jetParticlesRef.current = new THREE.Points(geometry, jetMaterialRef.current);\n    jetParticlesRef.current.visible = true; \n    jetParticlesRef.current.frustumCulled = false;\n    scene.add(jetParticlesRef.current);\n    lastJetParticleIndexRef.current = 0;\n  }, []);\n\n  const initStarEmittedParticles = useCallback(() => {\n    const THREE = THREEInstanceRef.current;\n    const scene = foregroundSceneRef.current; \n    if (!THREE || !scene) return;\n\n    if (starEmittedParticlesRef.current) {\n        scene.remove(starEmittedParticlesRef.current);\n        starEmittedParticlesRef.current.geometry.dispose();\n        if (starEmittedParticlesRef.current.material instanceof THREE.Material) {\n            (starEmittedParticlesRef.current.material as THREE_TYPE.Material).dispose();\n        }\n        starEmittedParticlesRef.current = null;\n    }\n\n    const geometry = new THREE.BufferGeometry();\n    const positions = new Float32Array(STAR_EMITTED_PARTICLE_COUNT * 3);\n    const colorsAttribute = new Float32Array(STAR_EMITTED_PARTICLE_COUNT * 3);\n    const sizesAttribute = new Float32Array(STAR_EMITTED_PARTICLE_COUNT);\n\n    starEmittedParticleDataRef.current = [];\n    for (let i = 0; i < STAR_EMITTED_PARTICLE_COUNT; i++) {\n        starEmittedParticleDataRef.current.push({\n            id: i,\n            position: new THREE.Vector3(0, -1000, 0), \n            velocity: new THREE.Vector3(),\n            life: 0, \n            initialLife: STAR_DISSOLUTION_PARTICLE_LIFESPAN, \n            color: new THREE.Color(1, 1, 1),\n            size: 0.0005, \n            active: false,\n        });\n        const i3 = i * 3;\n        positions[i3] = 0; positions[i3+1] = -1000; positions[i3+2] = 0;\n        colorsAttribute[i3] = 1; colorsAttribute[i3+1] = 1; colorsAttribute[i3+2] = 1;\n        sizesAttribute[i] = 0.0005;\n    }\n\n    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));\n    geometry.setAttribute('color', new THREE.Float32BufferAttribute(colorsAttribute, 3));\n    geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizesAttribute, 1));\n\n\n    starEmittedParticleMaterialRef.current = new THREE.PointsMaterial({\n        vertexColors: true,\n        transparent: true,\n        blending: THREE.AdditiveBlending,\n        depthWrite: false,\n        sizeAttenuation: true,\n    });\n\n    starEmittedParticlesRef.current = new THREE.Points(geometry, starEmittedParticleMaterialRef.current);\n    starEmittedParticlesRef.current.visible = true;\n    starEmittedParticlesRef.current.frustumCulled = false; \n    scene.add(starEmittedParticlesRef.current);\n    lastStarEmittedParticleIndexRef.current = 0;\n  }, []);\n\n  const initShatterParticles = useCallback(() => {\n    const THREE = THREEInstanceRef.current;\n    const scene = foregroundSceneRef.current;\n    if (!THREE || !scene) return;\n\n    if (shatterParticlesRef.current) {\n      scene.remove(shatterParticlesRef.current);\n      shatterParticlesRef.current.geometry.dispose();\n      if (shatterParticlesRef.current.material instanceof THREE.Material) {\n        (shatterParticlesRef.current.material as THREE_TYPE.Material).dispose();\n      }\n      shatterParticlesRef.current = null;\n    }\n\n    const geometry = new THREE.BufferGeometry();\n    const positions = new Float32Array(SHATTER_PARTICLE_POOL_SIZE * 3);\n    const colorsAttribute = new Float32Array(SHATTER_PARTICLE_POOL_SIZE * 3);\n    const sizesAttribute = new Float32Array(SHATTER_PARTICLE_POOL_SIZE);\n\n    shatterParticleDataRef.current = [];\n    for (let i = 0; i < SHATTER_PARTICLE_POOL_SIZE; i++) {\n      shatterParticleDataRef.current.push({\n        id: i,\n        position: new THREE.Vector3(0, -1000, 0), \n        velocity: new THREE.Vector3(),\n        life: 0,\n        initialLife: 1,\n        color: new THREE.Color(1, 1, 1),\n        size: 0.01,\n        active: false,\n      });\n      positions[i * 3] = 0; positions[i * 3 + 1] = -1000; positions[i * 3 + 2] = 0;\n      colorsAttribute[i*3] = 1; colorsAttribute[i*3+1] = 1; colorsAttribute[i*3+2] = 1;\n      sizesAttribute[i] = 0.01;\n    }\n\n    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));\n    geometry.setAttribute('color', new THREE.Float32BufferAttribute(colorsAttribute, 3));\n    geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizesAttribute, 1));\n\n\n    shatterParticleMaterialRef.current = new THREE.PointsMaterial({\n      vertexColors: true,\n      transparent: true,\n      blending: THREE.AdditiveBlending,\n      depthWrite: false,\n      sizeAttenuation: true,\n    });\n\n    shatterParticlesRef.current = new THREE.Points(geometry, shatterParticleMaterialRef.current);\n    shatterParticlesRef.current.visible = true;\n    shatterParticlesRef.current.frustumCulled = false;\n    scene.add(shatterParticlesRef.current);\n    lastShatterParticleIndexRef.current = 0;\n  }, []);\n\n\n  useEffect(() => {\n    const foregroundScene = foregroundSceneRef.current;\n    if (!foregroundScene || !THREEInstanceRef.current) return; \n\n    initJetParticles();\n    initStarEmittedParticles();\n    initShatterParticles();\n  }, [initJetParticles, initStarEmittedParticles, initShatterParticles]);\n\n\n  useEffect(() => {\n    if (!mountRef.current) return;\n\n    const LocalTHREE = require('three') as typeof THREE_TYPE;\n    THREEInstanceRef.current = LocalTHREE;\n    const THREE = THREEInstanceRef.current;\n    if (!THREE) return;\n\n    tempVectorRef.current = new THREE.Vector3();\n    tempVector2Ref.current = new THREE.Vector3();\n    tempQuaternionRef.current = new THREE.Quaternion();\n\n\n    const { OrbitControls } = require('three/examples/jsm/controls/OrbitControls.js') as { OrbitControls: typeof OrbitControlsType };\n    const { EffectComposer } = require('three/examples/jsm/postprocessing/EffectComposer.js') as { EffectComposer: typeof EffectComposerType };\n    const { RenderPass } = require('three/examples/jsm/postprocessing/RenderPass.js') as { RenderPass: typeof RenderPassType };\n    const { ShaderPass } = require('three/examples/jsm/postprocessing/ShaderPass.js') as { ShaderPass: typeof ShaderPassType };\n\n    if (!clockRef.current) {\n        clockRef.current = new THREE.Clock();\n    }\n\n    foregroundSceneRef.current = new THREE.Scene();\n    backgroundSceneRef.current = new THREE.Scene(); \n\n    const camera = new THREE.PerspectiveCamera(\n      75,\n      mountRef.current.clientWidth / mountRef.current.clientHeight,\n      0.1,\n      1000\n    );\n    camera.position.set(0, blackHoleRadiusRef_anim.current * 1.5, blackHoleRadiusRef_anim.current * 4);\n    cameraRef.current = camera;\n    if (onCameraReady) { onCameraReady(camera); }\n    if (onCameraUpdateRef.current) { onCameraUpdateRef.current({ x: camera.position.x, y: camera.position.y, z: camera.position.z });}\n\n\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\n    renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);\n    renderer.setPixelRatio(window.devicePixelRatio);\n    renderer.autoClear = false; \n    mountRef.current.appendChild(renderer.domElement);\n    rendererRef.current = renderer;\n\n    // Setup EffectComposer for post-processing\n    const composer = new EffectComposer(renderer);\n    composerRef.current = composer;\n\n    // Render everything (stars, accretion disk, planets) in one pass\n    // Stars are now in foregroundScene so they get lensed along with everything else\n    const renderPass = new RenderPass(foregroundSceneRef.current, camera);\n    composer.addPass(renderPass);\n\n    // Add lensing pass - bends everything around the black hole position\n    const lensingPass = new ShaderPass(LensingShader);\n    lensingPass.uniforms.resolution.value = new THREE.Vector2(\n      mountRef.current.clientWidth * window.devicePixelRatio,\n      mountRef.current.clientHeight * window.devicePixelRatio\n    );\n    lensingPass.uniforms.bhPos.value = new THREE.Vector2(0.5, 0.5);\n    lensingPassRef.current = lensingPass;\n    composer.addPass(lensingPass);\n    \n    // Render black hole on top after lensing (in animate loop)\n\n    sceneCaptureRenderTargetRef.current = new THREE.WebGLRenderTarget(\n        mountRef.current.clientWidth * window.devicePixelRatio,\n        mountRef.current.clientHeight * window.devicePixelRatio\n    );\n    if (sceneCaptureRenderTargetRef.current) {\n        sceneCaptureRenderTargetRef.current.texture.minFilter = THREE.LinearFilter;\n        sceneCaptureRenderTargetRef.current.texture.magFilter = THREE.LinearFilter;\n        sceneCaptureRenderTargetRef.current.texture.wrapS = THREE.ClampToEdgeWrapping;\n        sceneCaptureRenderTargetRef.current.texture.wrapT = THREE.ClampToEdgeWrapping;\n    }\n\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.05;\n    controls.screenSpacePanning = false;\n    controls.minDistance = blackHoleRadiusRef_anim.current * 1.2;\n    controls.maxDistance = 80; \n    controlsRef.current = controls;\n\n    controls.addEventListener('change', () => {\n      if (cameraRef.current && onCameraUpdateRef.current) {\n        onCameraUpdateRef.current({ x: cameraRef.current.position.x, y: cameraRef.current.position.y, z: cameraRef.current.position.z });\n      }\n    });\n\n    const blackHoleGeometry = new THREE.SphereGeometry(1, 64, 64); // Radius 1, scaled by blackHoleRadius prop\n    blackHoleMaterialRef.current = new THREE.ShaderMaterial({\n      vertexShader: blackHoleVertexShader,\n      fragmentShader: blackHoleFragmentShader,\n      uniforms: {\n        u_cameraPosition: { value: camera.position },\n      },\n    });\n    const blackHoleMesh = new THREE.Mesh(blackHoleGeometry, blackHoleMaterialRef.current);\n    blackHoleMesh.position.set(0,0,0); // Black hole at origin\n    foregroundSceneRef.current.add(blackHoleMesh);\n    blackHoleRef.current = blackHoleMesh;\n\n    createAndAddAccretionParticles(accretionDiskInnerRadius, accretionDiskOuterRadius, accretionDiskOpacity);\n\n    const starsGeometry = new THREE.BufferGeometry();\n    const starVertices = [];\n    const starInitialSizes = [];\n    starTwinkleDataRef.current = [];\n\n    for (let i = 0; i < NUM_BACKGROUND_STARS; i++) { \n        const r = 200 + Math.random() * 600; \n        const phi = Math.random() * Math.PI * 2;\n        const theta = Math.random() * Math.PI;\n        starVertices.push(r * Math.sin(theta) * Math.cos(phi), r * Math.sin(theta) * Math.sin(phi), r * Math.cos(theta));\n        \n        const initialSize = 2.0 + Math.random() * 3.0; // Range 2.0 to 5.0 - larger for visibility\n        starInitialSizes.push(initialSize);\n        starTwinkleDataRef.current.push({\n            initialSize: initialSize,\n            phase: Math.random() * Math.PI * 2,\n            speed: 0.3 + Math.random() * 0.7, // Twinkle speed\n        });\n    }\n    starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));\n    starsGeometry.setAttribute('size', new THREE.Float32BufferAttribute(starInitialSizes, 1));\n    \n    // Use shader material for stars to properly handle size attribute and twinkling\n    const starsMaterial = new THREE.ShaderMaterial({\n      uniforms: {\n        color: { value: new THREE.Color(0xffffff) },\n        time: { value: 0 },\n      },\n      vertexShader: `\n        attribute float size;\n        varying float vAlpha;\n        void main() {\n          vAlpha = 1.0;\n          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_PointSize = size * (300.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      `,\n      fragmentShader: `\n        uniform vec3 color;\n        varying float vAlpha;\n        void main() {\n          // Circular soft particle\n          vec2 coord = gl_PointCoord - vec2(0.5);\n          float dist = length(coord);\n          if (dist > 0.5) discard;\n          float alpha = 1.0 - smoothstep(0.3, 0.5, dist);\n          gl_FragColor = vec4(color, alpha);\n        }\n      `,\n      transparent: true,\n      blending: THREE.AdditiveBlending,\n      depthWrite: false,\n    });\n    starsRef.current = new THREE.Points(starsGeometry, starsMaterial);\n    starsRef.current.frustumCulled = false;\n    // Add stars to FOREGROUND scene so they get lensed with everything else\n    foregroundSceneRef.current.add(starsRef.current); \n\n    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);\n    foregroundSceneRef.current.add(ambientLight);\n\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);\n    directionalLight.position.set(5, 10, 7.5);\n    foregroundSceneRef.current.add(directionalLight);\n\n    if (!jetParticlesRef.current) initJetParticles();\n    if (!starEmittedParticlesRef.current) initStarEmittedParticles();\n    if (!shatterParticlesRef.current) initShatterParticles();\n\n\n    const currentRendererDomElement = renderer.domElement;\n    const handleCanvasShiftClick = (event: PointerEvent) => {\n      const THREE_INSTANCE = THREEInstanceRef.current;\n      if (!event.shiftKey || !cameraRef.current || !onShiftClickSpawnAtPointRef.current || !THREE_INSTANCE) return;\n      event.preventDefault();\n      event.stopPropagation();\n      const rect = currentRendererDomElement.getBoundingClientRect();\n      const mouse = new THREE_INSTANCE.Vector2();\n      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\n      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\n      const raycaster = new THREE_INSTANCE.Raycaster();\n      raycaster.setFromCamera(mouse, cameraRef.current);\n      const plane = new THREE_INSTANCE.Plane(new THREE_INSTANCE.Vector3(0, 1, 0), 0); // Assume spawn on XZ plane for now\n      const intersectionPoint = new THREE_INSTANCE.Vector3();\n      if (raycaster.ray.intersectPlane(plane, intersectionPoint)) {\n        onShiftClickSpawnAtPointRef.current(intersectionPoint);\n      }\n    };\n    currentRendererDomElement.addEventListener('pointerdown', handleCanvasShiftClick);\n\n\n    let animationFrameId: number;\n    const animate = () => {\n      animationFrameId = requestAnimationFrame(animate);\n      const THREE_ANIM = THREEInstanceRef.current;\n      const renderer_anim = rendererRef.current;\n      const fgScene_anim = foregroundSceneRef.current;\n      const mainCam_anim = cameraRef.current;\n      const bhMaterial_anim = blackHoleMaterialRef.current;\n      const bh_anim = blackHoleRef.current;\n      const _tempVec = tempVectorRef.current;\n      const _tempVec2 = tempVector2Ref.current; // For gravity\n      const _tempQuat = tempQuaternionRef.current;\n\n\n      if (!clockRef.current || !THREE_ANIM || !renderer_anim || !fgScene_anim || !mainCam_anim || !bhMaterial_anim || !bh_anim || !_tempVec || !_tempVec2 || !_tempQuat) return;\n\n      const deltaTime = clockRef.current.getDelta();\n      const elapsedTime = clockRef.current.getElapsedTime();\n      const effectiveDeltaTime = deltaTime * simulationSpeedRef_anim.current;\n\n\n      controlsRef.current?.update();\n      \n      // Update black hole material camera position\n      bhMaterial_anim.uniforms.u_cameraPosition.value.copy(mainCam_anim.position);\n      \n      // Update lensing pass uniforms\n      if (lensingPassRef.current) {\n        const lensingPass = lensingPassRef.current;\n        \n        // Project black hole position to screen space\n        const bhPos = bh_anim.position.clone();\n        const vector = bhPos.project(mainCam_anim);\n        const screenX = (vector.x + 1) / 2;\n        const screenY = (vector.y + 1) / 2;\n        \n        // Calculate screen-space radius based on distance to camera\n        // This ensures consistent size when rotating around the black hole\n        const distance = bhPos.distanceTo(mainCam_anim.position);\n        const fov = mainCam_anim.fov * (Math.PI / 180); // Convert to radians\n        const screenHeight = 2 * Math.tan(fov / 2) * distance;\n        const screenRadius = (blackHoleRadiusRef_anim.current / screenHeight) * 0.5; // 0.5 because project() maps to 0-1\n        \n        lensingPass.uniforms.bhPos.value.set(screenX, screenY);\n        lensingPass.uniforms.bhRadius.value = screenRadius;\n        lensingPass.uniforms.mass.value = blackHoleRadiusRef_anim.current * 25; // Stronger mass for better lensing\n      } \n\n\n      // Accretion disk animation\n      if (accretionDiskRef.current?.geometry) {\n        const positions = accretionDiskRef.current.geometry.attributes.position.array as Float32Array;\n        for (let i = 0; i < diskParticleDataRef.current.length; i++) {\n          const pData = diskParticleDataRef.current[i];\n          pData.angle += pData.angularVelocity * effectiveDeltaTime; \n          const i3 = i * 3;\n          positions[i3] = pData.radius * Math.cos(pData.angle);\n          positions[i3 + 2] = pData.radius * Math.sin(pData.angle);\n        }\n        accretionDiskRef.current.geometry.attributes.position.needsUpdate = true;\n      }\n\n      // Background stars twinkling animation\n      if (starsRef.current?.geometry) {\n        const sizes = starsRef.current.geometry.attributes.size as THREE_TYPE.BufferAttribute;\n        const twinkleData = starTwinkleDataRef.current;\n        if (sizes && twinkleData.length === NUM_BACKGROUND_STARS) {\n            for (let i = 0; i < NUM_BACKGROUND_STARS; i++) {\n                const data = twinkleData[i];\n                const scale = 0.6 + Math.sin(elapsedTime * data.speed + data.phase) * 0.4; // Modulates between 0.2 and 1.0\n                (sizes.array as Float32Array)[i] = data.initialSize * Math.max(0.1, scale); // Ensure size is positive\n            }\n            sizes.needsUpdate = true;\n        }\n      }\n\n      // N-body physics for spawned objects\n      spawnedObjectsRef_anim.current.forEach(objProp => {\n        const object3D = celestialObjectsRef.current.get(objProp.id);\n        let evolvingData = evolvingObjectDataRef.current.get(objProp.id);\n\n        if (!object3D || !evolvingData) return;\n\n        evolvingData.ttl -= deltaTime; // TTL uses raw deltaTime\n\n        const blackHoleActualRadius = blackHoleRadiusRef_anim.current;\n        const currentStarMassFactor = (objProp.type === 'star' ? objProp.currentMassFactor : 1.0) ?? 1.0;\n\n        if (objProp.isDissolving) {\n            let progress = dissolvingObjectsProgressRef.current.get(objProp.id) || 0;\n            progress += deltaTime / (objProp.timeToLive > 0 ? objProp.timeToLive : DISSOLUTION_DURATION); \n            progress = Math.min(progress, 1);\n            dissolvingObjectsProgressRef.current.set(objProp.id, progress);\n\n            const scaleFactor = 1 - progress;\n            object3D.scale.set(\n                objProp.initialScale.x * currentStarMassFactor * scaleFactor,\n                objProp.initialScale.y * currentStarMassFactor * scaleFactor,\n                objProp.initialScale.z * currentStarMassFactor * scaleFactor\n            );\n\n            // Simplified pull towards black hole when dissolving\n            _tempVec.copy(bh_anim.position).sub(evolvingData.position).normalize();\n            evolvingData.velocity.addScaledVector(_tempVec, PULL_IN_FACTOR_DISSOLVING_BH * blackHoleActualRadius * effectiveDeltaTime * (0.5 + progress * 1.5));\n            evolvingData.position.addScaledVector(evolvingData.velocity, effectiveDeltaTime);\n\n\n            if (objProp.type === 'star' && starEmittedParticlesRef.current && starEmittedParticleDataRef.current.length > 0 && object3D) {\n                const starColor = new THREE_ANIM.Color(objProp.color);\n                for (let i = 0; i < STAR_DISSOLUTION_EMIT_RATE_PER_FRAME; i++) {\n                    const pIndex = lastStarEmittedParticleIndexRef.current;\n                    const particle = starEmittedParticleDataRef.current[pIndex];\n                    if (particle && !particle.active) {\n                        particle.active = true;\n                        particle.position.copy(object3D.position); \n                        const randomDirection = new THREE_ANIM.Vector3(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5).normalize();\n                        particle.velocity.copy(randomDirection).multiplyScalar(STAR_DISSOLUTION_PARTICLE_INITIAL_SPEED);\n                        particle.life = 1.0; \n                        particle.initialLife = STAR_DISSOLUTION_PARTICLE_LIFESPAN + Math.random() * 0.1;\n                        particle.color.copy(starColor);\n                        particle.size = (0.0005 + Math.random() * 0.0005) * Math.min(1.0, currentStarMassFactor * 0.5 + 0.5);\n                    }\n                    lastStarEmittedParticleIndexRef.current = (pIndex + 1) % STAR_EMITTED_PARTICLE_COUNT;\n                }\n            }\n\n            if (progress >= 1 || evolvingData.position.lengthSq() < blackHoleActualRadius * blackHoleActualRadius * 0.01) {\n                if (onAbsorbPlanetRef.current) onAbsorbPlanetRef.current(objProp.id);\n                 evolvingObjectDataRef.current.delete(objProp.id);\n                 dissolvingObjectsProgressRef.current.delete(objProp.id);\n            }\n        } else { \n            // N-body gravitational physics for non-dissolving objects\n            const acceleration = _tempVec2.set(0, 0, 0);\n            const currentMass = objProp.type === 'star' \n                ? STAR_BASE_MASS * currentStarMassFactor \n                : PLANET_BASE_MASS * (objProp.initialScale.x / 0.1); \n\n            // Gravity from Black Hole\n            const blackHoleEffectiveMass = BLACK_HOLE_MASS_EQUIVALENT_FACTOR * blackHoleActualRadius;\n            _tempVec.copy(bh_anim.position).sub(evolvingData.position);\n            let distSqToBH = _tempVec.lengthSq();\n            distSqToBH = Math.max(distSqToBH, MIN_GRAVITY_DISTANCE_SQ + blackHoleActualRadius * blackHoleActualRadius); \n            const forceMagBH = (G_CONSTANT * blackHoleEffectiveMass * currentMass) / distSqToBH;\n            acceleration.addScaledVector(_tempVec.normalize(), forceMagBH / currentMass);\n\n\n            // Gravity from other Stars\n            spawnedObjectsRef_anim.current.forEach(otherObjProp => {\n                if (otherObjProp.id !== objProp.id && otherObjProp.type === 'star' && !otherObjProp.isDissolving) {\n                    const otherObject3D = celestialObjectsRef.current.get(otherObjProp.id);\n                    const otherEvolvingData = evolvingObjectDataRef.current.get(otherObjProp.id);\n                    if (otherObject3D && otherEvolvingData) {\n                        const otherStarMass = STAR_BASE_MASS * (otherObjProp.currentMassFactor || 1.0);\n                        _tempVec.copy(otherEvolvingData.position).sub(evolvingData.position);\n                        let distSqToOther = _tempVec.lengthSq();\n                        distSqToOther = Math.max(distSqToOther, MIN_GRAVITY_DISTANCE_SQ);\n                        const forceMagOther = (G_CONSTANT * otherStarMass * currentMass) / distSqToOther;\n                        acceleration.addScaledVector(_tempVec.normalize(), forceMagOther / currentMass);\n                    }\n                }\n            });\n            \n            evolvingData.velocity.addScaledVector(acceleration, effectiveDeltaTime);\n            evolvingData.position.addScaledVector(evolvingData.velocity, effectiveDeltaTime);\n            \n            if (evolvingData.position.lengthSq() < (blackHoleActualRadius * DISSOLUTION_START_RADIUS_FACTOR * blackHoleActualRadius * DISSOLUTION_START_RADIUS_FACTOR) && onSetPlanetDissolvingRef.current) {\n                 onSetPlanetDissolvingRef.current(objProp.id, true);\n            } else if (evolvingData.ttl <= 0 || evolvingData.position.lengthSq() < blackHoleActualRadius * blackHoleActualRadius * 0.01) { \n                if (onAbsorbPlanetRef.current) onAbsorbPlanetRef.current(objProp.id);\n                evolvingObjectDataRef.current.delete(objProp.id);\n                dissolvingObjectsProgressRef.current.delete(objProp.id);\n            }\n        }\n        object3D.position.copy(evolvingData.position);\n        object3D.scale.set( \n              objProp.initialScale.x * currentStarMassFactor * (objProp.isDissolving ? (1 - (dissolvingObjectsProgressRef.current.get(objProp.id) || 0)) : 1),\n              objProp.initialScale.y * currentStarMassFactor * (objProp.isDissolving ? (1 - (dissolvingObjectsProgressRef.current.get(objProp.id) || 0)) : 1),\n              objProp.initialScale.z * currentStarMassFactor * (objProp.isDissolving ? (1 - (dissolvingObjectsProgressRef.current.get(objProp.id) || 0)) : 1)\n        );\n\n        if (evolvingData.velocity.lengthSq() > 0.001 && !objProp.isDissolving) {\n             _tempVec.copy(evolvingData.position).add(evolvingData.velocity); \n             object3D.lookAt(_tempVec);\n        } else if (objProp.isDissolving) {\n             object3D.quaternion.slerp(_tempQuat.setFromUnitVectors(new THREE_ANIM.Vector3(0,0,1), new THREE_ANIM.Vector3(0,0,1)), 0.1); \n        }\n\n\n        if(onUpdatePlanetPositionRef.current) { \n             onUpdatePlanetPositionRef.current(objProp.id, \n                {x: evolvingData.position.x, y: evolvingData.position.y, z: evolvingData.position.z},\n                {x: evolvingData.velocity.x, y: evolvingData.velocity.y, z: evolvingData.velocity.z}\n             );\n        }\n      });\n\n      // Star emitted particles update\n      if (starEmittedParticlesRef.current?.geometry && starEmittedParticleMaterialRef.current && starEmittedParticleDataRef.current.length > 0 && THREE_ANIM) {\n        const positions = starEmittedParticlesRef.current.geometry.attributes.position.array as Float32Array;\n        const colors = starEmittedParticlesRef.current.geometry.attributes.color.array as Float32Array;\n        const sizes = starEmittedParticlesRef.current.geometry.attributes.size.array as Float32Array;\n        let hasActiveStarParticles = false;\n\n        starEmittedParticleDataRef.current.forEach((p, i) => {\n            if (p.active && p.life > 0) {\n                hasActiveStarParticles = true;\n                _tempVec.copy(bh_anim.position).sub(p.position);\n                const distanceSq = Math.max(0.1, p.position.lengthSq());\n                const gravityFactor = STAR_DISSOLUTION_PARTICLE_GRAVITY_FACTOR;\n                _tempVec.normalize().multiplyScalar(gravityFactor / distanceSq);\n                p.velocity.addScaledVector(_tempVec, effectiveDeltaTime);\n                p.position.addScaledVector(p.velocity, effectiveDeltaTime);\n\n                p.life -= deltaTime / p.initialLife; \n                const i3 = i * 3;\n                positions[i3] = p.position.x; positions[i3 + 1] = p.position.y; positions[i3 + 2] = p.position.z;\n                const fade = Math.max(0, p.life); \n                colors[i3] = p.color.r * fade; colors[i3 + 1] = p.color.g * fade; colors[i3 + 2] = p.color.b * fade;\n                sizes[i] = p.size * fade;\n                if (p.life <= 0 || p.position.lengthSq() < (blackHoleRadiusRef_anim.current * blackHoleRadiusRef_anim.current * 0.01) ) {\n                    p.active = false; positions[i3+1] = -1000; \n                }\n            } else if (p.active === false && positions[i*3+1] > -999) { \n                 positions[i*3+1] = -1000; hasActiveStarParticles = true; \n            }\n        });\n        if(hasActiveStarParticles){\n            starEmittedParticlesRef.current.geometry.attributes.position.needsUpdate = true;\n            starEmittedParticlesRef.current.geometry.attributes.color.needsUpdate = true;\n            starEmittedParticlesRef.current.geometry.attributes.size.needsUpdate = true;\n        }\n      }\n\n      // Jet particles update\n      if (jetParticlesRef.current?.geometry && jetMaterialRef.current && jetParticleDataRef.current.length > 0 && THREE_ANIM) {\n            const positions = jetParticlesRef.current.geometry.attributes.position.array as Float32Array;\n            const colorsAttribute = jetParticlesRef.current.geometry.attributes.color.array as Float32Array;\n            const sizesAttribute = jetParticlesRef.current.geometry.attributes.size.array as Float32Array;\n            let activeJetsVisualsNeedUpdate = false;\n\n            if (isEmittingJetsRef_anim.current) {\n                activeJetsVisualsNeedUpdate = true; \n                for (let jetDirection of [1, -1]) { \n                    for (let i = 0; i < JET_EMIT_BURST_COUNT; i++) {\n                        const pIndex = lastJetParticleIndexRef.current;\n                        const jetP = jetParticleDataRef.current[pIndex];\n                        if (jetP && !jetP.active) {\n                            jetP.active = true; \n                            jetP.position.set(0, jetDirection * blackHoleRadiusRef_anim.current * 1.05, 0);\n                            \n                            const coneAngle = Math.random() * Math.PI * 2;\n                            const elevationAngle = (Math.random() * JET_SPREAD_ANGLE) - (JET_SPREAD_ANGLE / 2);\n                            let velDir = new THREE_ANIM.Vector3(\n                                Math.sin(elevationAngle) * Math.cos(coneAngle),\n                                Math.cos(elevationAngle) * jetDirection,\n                                Math.sin(elevationAngle) * Math.sin(coneAngle)\n                            );\n                            const randomOffset = new THREE_ANIM.Vector3(Math.random()-0.5, Math.random()-0.5, Math.random()-0.5)\n                                                    .normalize().multiplyScalar(JET_VELOCITY_RANDOM_OFFSET_MAGNITUDE);\n                            velDir.add(randomOffset).normalize();\n                            \n                            jetP.velocity.copy(velDir).multiplyScalar(JET_SPEED * (0.7 + Math.random() * 0.6));\n                            jetP.life = 1.0; \n                            jetP.initialLife = JET_LIFESPAN * (0.6 + Math.random() * 0.8);\n                            jetP.color.setHSL(Math.random() * 0.15 + 0.50, 0.95, 0.85); \n                            jetP.size = JET_PARTICLE_BASE_SIZE; \n\n                            positions[pIndex*3] = jetP.position.x; \n                            positions[pIndex*3+1] = jetP.position.y; \n                            positions[pIndex*3+2] = jetP.position.z;\n                            \n                            lastJetParticleIndexRef.current = (pIndex + 1) % JET_PARTICLE_COUNT;\n                        } else if (jetP && jetP.active) {\n                            // If the current particle slot is already active, try the next one, but don't loop indefinitely in one frame if all are active.\n                            // This 'break' ensures we don't over-process if the pool is full and we can't find an inactive particle quickly.\n                            break; \n                        }\n                    }\n                }\n            }\n\n            jetParticleDataRef.current.forEach((p, i) => {\n                const i3 = i * 3;\n                if (p.active && p.life > 0) {\n                    activeJetsVisualsNeedUpdate = true;\n                    p.position.addScaledVector(p.velocity, effectiveDeltaTime); \n                    p.life -= deltaTime / p.initialLife; \n                    \n                    positions[i3] = p.position.x; \n                    positions[i3 + 1] = p.position.y; \n                    positions[i3 + 2] = p.position.z;\n                    \n                    const fade = Math.max(0, p.life);\n                    colorsAttribute[i3] = p.color.r * fade; \n                    colorsAttribute[i3 + 1] = p.color.g * fade; \n                    colorsAttribute[i3 + 2] = p.color.b * fade;\n                    sizesAttribute[i] = p.size * fade; \n                    \n                    if (p.life <= 0) { \n                        p.active = false; \n                        positions[i3+1] = -1000; \n                    }\n                } else if (!p.active && positions[i3+1] > -999) { \n                     positions[i3+1] = -1000; \n                     activeJetsVisualsNeedUpdate = true;\n                }\n            });\n            \n            jetParticlesRef.current.visible = true; \n            if (activeJetsVisualsNeedUpdate) { \n              jetParticlesRef.current.geometry.attributes.position.needsUpdate = true;\n              jetParticlesRef.current.geometry.attributes.color.needsUpdate = true;\n              jetParticlesRef.current.geometry.attributes.size.needsUpdate = true;\n            }\n        }\n\n      // Process collision events for shatter particles\n      if (collisionEventsRef.current.length > 0 && shatterParticlesRef.current?.geometry && THREE_ANIM) {\n        collisionEventsRef.current.forEach(event => {\n          const collisionTHREEPoint = new THREE_ANIM.Vector3(event.point.x, event.point.y, event.point.z);\n          const color1 = new THREE_ANIM.Color(event.color1);\n          const color2 = new THREE_ANIM.Color(event.color2);\n\n          for (let i = 0; i < SHATTER_PARTICLES_PER_COLLISION; i++) {\n            const pIndex = lastShatterParticleIndexRef.current;\n            const particle = shatterParticleDataRef.current[pIndex];\n\n            if (particle && !particle.active) {\n              particle.active = true;\n              particle.position.copy(collisionTHREEPoint);\n              particle.velocity.set(\n                (Math.random() - 0.5),\n                (Math.random() - 0.5),\n                (Math.random() - 0.5)\n              ).normalize().multiplyScalar(SHATTER_PARTICLE_SPEED_MIN + Math.random() * (SHATTER_PARTICLE_SPEED_MAX - SHATTER_PARTICLE_SPEED_MIN));\n              particle.initialLife = SHATTER_PARTICLE_LIFESPAN_MIN + Math.random() * (SHATTER_PARTICLE_LIFESPAN_MAX - SHATTER_PARTICLE_LIFESPAN_MIN);\n              particle.life = 1.0; \n              particle.color.copy(Math.random() > 0.5 ? color1 : color2); \n              particle.size = SHATTER_PARTICLE_SIZE_MIN + Math.random() * (SHATTER_PARTICLE_SIZE_MAX - SHATTER_PARTICLE_SIZE_MIN); \n            }\n            lastShatterParticleIndexRef.current = (pIndex + 1) % SHATTER_PARTICLE_POOL_SIZE;\n          }\n          if (onCollisionEventProcessedRef.current) {\n            onCollisionEventProcessedRef.current(event.id);\n          }\n        });\n      }\n      \n      // Update shatter particles\n      if (shatterParticlesRef.current?.geometry && shatterParticleDataRef.current.length > 0 && THREE_ANIM && tempVectorRef.current) {\n        const positions = shatterParticlesRef.current.geometry.attributes.position.array as Float32Array;\n        const colors = shatterParticlesRef.current.geometry.attributes.color.array as Float32Array;\n        const sizes = shatterParticlesRef.current.geometry.attributes.size.array as Float32Array;\n        let hasActiveShatterParticles = false;\n        const blackHoleActualRadius = blackHoleRadiusRef_anim.current;\n\n        shatterParticleDataRef.current.forEach((p, i) => {\n          const i3 = i * 3;\n          if (p.active && p.life > 0) {\n            hasActiveShatterParticles = true;\n            \n            const distanceToBHSq = p.position.lengthSq(); \n            let effectiveGravityFactor = SHATTER_PARTICLE_GRAVITY_FACTOR_BASE;\n\n            const nearBHThresholdRadius = blackHoleActualRadius * SHATTER_PARTICLE_NEAR_BH_THRESHOLD_FACTOR;\n            const isNearBH = distanceToBHSq < (nearBHThresholdRadius * nearBHThresholdRadius);\n\n            const quickAbsorptionRadius = blackHoleActualRadius * SHATTER_PARTICLE_QUICK_ABSORPTION_RADIUS_FACTOR;\n            const isVeryCloseToBH = distanceToBHSq < (quickAbsorptionRadius * quickAbsorptionRadius);\n\n            if (isNearBH) {\n                effectiveGravityFactor *= SHATTER_PARTICLE_GRAVITY_BOOST_NEAR_BH;\n                if (SHATTER_PARTICLE_SPIRAL_STRENGTH_NEAR_BH > 0 && tempVectorRef.current) {\n                    const tangentDirection = tempVectorRef.current.set(-p.position.z, 0, p.position.x).normalize(); \n                    const closenessFactor = Math.max(0, 1.0 - (Math.sqrt(distanceToBHSq) / nearBHThresholdRadius));\n                    const spiralMagnitude = SHATTER_PARTICLE_SPIRAL_STRENGTH_NEAR_BH * closenessFactor * effectiveGravityFactor * effectiveDeltaTime * 0.1; \n                    p.velocity.addScaledVector(tangentDirection, spiralMagnitude);\n                }\n            }\n            \n            if (tempVectorRef.current) {\n              const forceDirection = tempVectorRef.current.copy(p.position).negate(); \n              const invDistanceSq = 1.0 / Math.max(0.01, distanceToBHSq); \n              forceDirection.normalize().multiplyScalar(effectiveGravityFactor * blackHoleActualRadius * invDistanceSq); \n              p.velocity.addScaledVector(forceDirection, effectiveDeltaTime);\n            }\n            p.position.addScaledVector(p.velocity, effectiveDeltaTime);\n            \n            let lifeReductionFactor = 1.0;\n            if (isVeryCloseToBH) {\n                lifeReductionFactor = SHATTER_PARTICLE_LIFESPAN_REDUCTION_NEAR_ABSORPTION;\n            }\n            p.life -= (deltaTime / p.initialLife) * lifeReductionFactor; \n\n            positions[i3] = p.position.x; positions[i3 + 1] = p.position.y; positions[i3 + 2] = p.position.z;\n            const fade = Math.max(0, p.life);\n            colors[i3] = p.color.r * fade; colors[i3 + 1] = p.color.g * fade; colors[i3 + 2] = p.color.b * fade;\n            sizes[i] = p.size * fade;\n\n            if (p.life <= 0 || distanceToBHSq < (blackHoleActualRadius * blackHoleActualRadius * 0.9)) {\n              p.active = false; positions[i3+1] = -1000; \n            }\n          } else if (!p.active && positions[i3+1] > -999) {\n             positions[i3+1] = -1000; hasActiveShatterParticles = true;\n          }\n        });\n\n        if (hasActiveShatterParticles) {\n          shatterParticlesRef.current.geometry.attributes.position.needsUpdate = true;\n          shatterParticlesRef.current.geometry.attributes.color.needsUpdate = true;\n          shatterParticlesRef.current.geometry.attributes.size.needsUpdate = true;\n        }\n      }\n\n\n      // Render using EffectComposer with lensing post-processing\n      if (composerRef.current && renderer_anim && blackHoleRef.current && foregroundSceneRef.current) {\n        // Hide black hole so it doesn't get lensed\n        blackHoleRef.current.visible = false;\n        \n        // Render everything through composer (gets lensed)\n        composerRef.current.render();\n        \n        // Render black hole on top (not lensed, just masks the center)\n        blackHoleRef.current.visible = true;\n        renderer_anim.clearDepth();\n        renderer_anim.render(foregroundSceneRef.current, mainCam_anim);\n      } \n    };\n    animate();\n\n    const handleResize = () => {\n      if (mountRef.current && cameraRef.current && rendererRef.current && composerRef.current && lensingPassRef.current) {\n        const width = mountRef.current.clientWidth;\n        const height = mountRef.current.clientHeight;\n        cameraRef.current.aspect = width / height;\n        cameraRef.current.updateProjectionMatrix();\n        rendererRef.current.setSize(width, height);\n        composerRef.current.setSize(width, height);\n        lensingPassRef.current.uniforms.resolution.value.set(\n          width * window.devicePixelRatio,\n          height * window.devicePixelRatio\n        );\n      }\n    };\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      if (currentRendererDomElement) {\n        currentRendererDomElement.removeEventListener('pointerdown', handleCanvasShiftClick);\n      }\n      if (controlsRef.current) { controlsRef.current.dispose(); }\n      if (composerRef.current) { composerRef.current.dispose(); }\n      cancelAnimationFrame(animationFrameId);\n\n      const THREE_CLEANUP = THREEInstanceRef.current;\n      if (THREE_CLEANUP) {\n        celestialObjectsRef.current.forEach(object => {\n          foregroundSceneRef.current?.remove(object); \n          if (object instanceof THREE_CLEANUP.Group) {\n            object.traverse(child => {\n               if (child instanceof THREE_CLEANUP.Mesh) {\n                  child.geometry?.dispose();\n                   if (Array.isArray(child.material)) { child.material.forEach(m => m.dispose()); } \n                   else { (child.material as THREE_TYPE.Material)?.dispose(); }\n               }\n            });\n          } else if (object instanceof THREE_CLEANUP.Mesh) {\n            object.geometry?.dispose();\n            if (object.material) { (object.material as THREE_TYPE.Material).dispose(); }\n          }\n        });\n      }\n      celestialObjectsRef.current.clear();\n      dissolvingObjectsProgressRef.current.clear();\n      evolvingObjectDataRef.current.clear();\n      starTwinkleDataRef.current = [];\n\n\n      const disposeParticleSystem = (systemRef: React.MutableRefObject<THREE_TYPE.Points | null>) => {\n        const THREE_CLEANUP_PARTICLES = THREEInstanceRef.current;\n        if (systemRef.current) {\n            systemRef.current.geometry.dispose();\n            if (THREE_CLEANUP_PARTICLES && systemRef.current.material instanceof THREE_CLEANUP_PARTICLES.Material) {\n                 (systemRef.current.material as THREE_TYPE.Material).dispose();\n            }\n            foregroundSceneRef.current?.remove(systemRef.current);\n            systemRef.current = null;\n        }\n      };\n\n      disposeParticleSystem(jetParticlesRef);\n      disposeParticleSystem(starEmittedParticlesRef);\n      disposeParticleSystem(shatterParticlesRef);\n\n\n      sceneCaptureRenderTargetRef.current?.dispose();\n      \n      foregroundSceneRef.current?.traverse(object => {\n        const THREE_CLEANUP = THREEInstanceRef.current;\n        if (!THREE_CLEANUP) return;\n        if (object instanceof THREE_CLEANUP.Mesh || object instanceof THREE_CLEANUP.Points || object instanceof THREE_CLEANUP.LineSegments) {\n            if (object.geometry) object.geometry.dispose();\n            const material = object.material as THREE_TYPE.Material | THREE_TYPE.Material[];\n            if (material) {\n              if (Array.isArray(material)) { material.forEach(mat => mat.dispose()); } \n              else { material.dispose(); }\n            }\n          }\n      });\n\n      backgroundSceneRef.current?.traverse(object => {\n         const THREE_CLEANUP_BG = THREEInstanceRef.current;\n         if (!THREE_CLEANUP_BG) return;\n         if (object instanceof THREE_CLEANUP_BG.Points) {\n            if (object.geometry) object.geometry.dispose();\n            if (object.material) (object.material as THREE_TYPE.Material).dispose();\n         }\n      });\n\n      if (mountRef.current && rendererRef.current) {\n        mountRef.current.removeChild(rendererRef.current.domElement);\n      }\n      rendererRef.current?.dispose();\n      diskParticleDataRef.current = [];\n      THREEInstanceRef.current = null;\n    };\n  }, []); \n\n  useEffect(() => {\n    if (blackHoleRef.current) {\n      // Scale the visual representation of the black hole\n      blackHoleRef.current.scale.set(blackHoleRadiusRef_anim.current, blackHoleRadiusRef_anim.current, blackHoleRadiusRef_anim.current);\n    }\n    if (controlsRef.current) {\n        controlsRef.current.minDistance = blackHoleRadiusRef_anim.current * 1.2;\n    }\n     if (cameraRef.current && cameraRef.current.position.length() < blackHoleRadiusRef_anim.current * 1.2) {\n        const newPos = cameraRef.current.position.clone().normalize().multiplyScalar(blackHoleRadiusRef_anim.current * 1.2);\n        cameraRef.current.position.copy(newPos);\n        if (onCameraUpdateRef.current) {\n            onCameraUpdateRef.current({x: newPos.x, y: newPos.y, z:newPos.z});\n        }\n    }\n  }, [blackHoleRadius]);\n\n  useEffect(() => {\n    if (foregroundSceneRef.current && THREEInstanceRef.current) { \n       createAndAddAccretionParticles(\n        accretionDiskInnerRadius,\n        accretionDiskOuterRadius,\n        accretionDiskOpacity\n      );\n    }\n  }, [accretionDiskInnerRadius, accretionDiskOuterRadius, accretionDiskOpacity, createAndAddAccretionParticles]);\n\n\n  useEffect(() => {\n    const scene = foregroundSceneRef.current; \n    const THREE_OBJECTS = THREEInstanceRef.current; // Renamed from THREE_PLANETS\n    if (!scene || !THREE_OBJECTS) return;\n\n    const currentObjectIds = new Set(Array.from(celestialObjectsRef.current.keys()));\n    const incomingObjectIds = new Set(spawnedPlanets.map(p => p.id)); // spawnedPlanets are the props\n\n    spawnedPlanets.forEach(objProp => { // objProp is from props\n      let object3D = celestialObjectsRef.current.get(objProp.id);\n      const currentStarMassFactor = (objProp.type === 'star' ? objProp.currentMassFactor : 1.0) ?? 1.0;\n\n      if (!object3D) { // Object doesn't exist in scene, create it\n        const sphereGeometry = new THREE_OBJECTS.SphereGeometry(1, 16, 16); // Unit sphere\n        let sphereMaterial;\n\n        if (objProp.type === 'star') {\n          const starGroup = new THREE_OBJECTS.Group(); \n          sphereMaterial = new THREE_OBJECTS.MeshBasicMaterial({ color: objProp.color }); \n          const starSphere = new THREE_OBJECTS.Mesh(sphereGeometry, sphereMaterial);\n          starGroup.add(starSphere);\n          object3D = starGroup;\n        } else { \n          sphereMaterial = new THREE_OBJECTS.MeshStandardMaterial({ color: objProp.color, roughness: 0.5, metalness: 0.1 });\n          object3D = new THREE_OBJECTS.Mesh(sphereGeometry, sphereMaterial);\n        }\n        \n        // Set initial position and scale from objProp\n        object3D.position.set(objProp.position!.x, objProp.position!.y, objProp.position!.z);\n        object3D.scale.set(\n            objProp.initialScale.x * currentStarMassFactor,\n            objProp.initialScale.y * currentStarMassFactor,\n            objProp.initialScale.z * currentStarMassFactor\n        );\n\n        scene.add(object3D);\n        celestialObjectsRef.current.set(objProp.id, object3D);\n        (object3D as any).userData = { objectId: objProp.id }; \n\n        evolvingObjectDataRef.current.set(objProp.id, {\n          id: objProp.id,\n          position: new THREE_OBJECTS.Vector3(objProp.position!.x, objProp.position!.y, objProp.position!.z),\n          velocity: new THREE_OBJECTS.Vector3(objProp.velocity.x, objProp.velocity.y, objProp.velocity.z),\n          ttl: objProp.timeToLive,\n        });\n      } else { // Object exists, update its properties if necessary (e.g. color, mass for stars)\n        const evolvingData = evolvingObjectDataRef.current.get(objProp.id);\n        if (evolvingData) {\n            // Update color if changed (though color typically doesn't change post-spawn)\n            if (objProp.type === 'star' && object3D instanceof THREE_OBJECTS.Group) {\n                const starSphere = object3D.children.find(child => child instanceof THREE_OBJECTS.Mesh) as THREE_TYPE.Mesh;\n                if (starSphere && starSphere.material instanceof THREE_OBJECTS.MeshBasicMaterial) {\n                    if (starSphere.material.color.getHexString() !== new THREE_OBJECTS.Color(objProp.color).getHexString()){\n                        starSphere.material.color.set(objProp.color);\n                    }\n                }\n            } else if (objProp.type === 'planet' && object3D instanceof THREE_OBJECTS.Mesh) {\n                if (object3D.material instanceof THREE_OBJECTS.MeshStandardMaterial) { \n                     if (object3D.material.color.getHexString() !== new THREE_OBJECTS.Color(objProp.color).getHexString()){\n                        object3D.material.color.set(objProp.color);\n                    }\n                }\n            }\n            // Update TTL if it changed in props (e.g. due to dissolution trigger)\n            if (objProp.isDissolving && evolvingData.ttl > objProp.timeToLive) { \n                 evolvingData.ttl = objProp.timeToLive;\n            } else if (!objProp.isDissolving && evolvingData.ttl !== objProp.timeToLive) { // Reset TTL if not dissolving\n                evolvingData.ttl = objProp.timeToLive;\n            }\n            // Position and velocity are driven by physics loop, but ensure scale reflects mass changes for stars\n            object3D.scale.set(\n              objProp.initialScale.x * currentStarMassFactor * (objProp.isDissolving ? (1 - (dissolvingObjectsProgressRef.current.get(objProp.id) || 0)) : 1),\n              objProp.initialScale.y * currentStarMassFactor * (objProp.isDissolving ? (1 - (dissolvingObjectsProgressRef.current.get(objProp.id) || 0)) : 1),\n              objProp.initialScale.z * currentStarMassFactor * (objProp.isDissolving ? (1 - (dissolvingObjectsProgressRef.current.get(objProp.id) || 0)) : 1)\n            );\n        }\n      }\n    });\n    \n    // Remove objects from scene if they are no longer in spawnedPlanets prop\n    currentObjectIds.forEach(id => {\n      if (!incomingObjectIds.has(id)) {\n        const object3D = celestialObjectsRef.current.get(id);\n        if (object3D) {\n          scene.remove(object3D); \n          if (object3D instanceof THREE_OBJECTS.Group) { \n            object3D.traverse(child => {\n              if (child instanceof THREE_OBJECTS.Mesh) {\n                child.geometry?.dispose();\n                if (Array.isArray(child.material)) { child.material.forEach(m => m.dispose());} \n                else { (child.material as THREE_TYPE.Material)?.dispose(); }\n              }\n            });\n          } else if (object3D instanceof THREE_OBJECTS.Mesh) { \n            object3D.geometry?.dispose();\n             if (object3D.material) { (object3D.material as THREE_TYPE.Material).dispose(); }\n          }\n          celestialObjectsRef.current.delete(id);\n        }\n        evolvingObjectDataRef.current.delete(id);\n        dissolvingObjectsProgressRef.current.delete(id);\n      }\n    });\n  }, [spawnedPlanets]); // Re-run when the spawnedPlanets prop array changes\n\n\n  return <div ref={mountRef} className=\"w-full h-full outline-none\" data-ai-hint=\"galaxy space\" />;\n};\n\nexport default ThreeBlackholeCanvas;\n    \n"],"names":[],"mappings":"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","debugId":null}}]
}