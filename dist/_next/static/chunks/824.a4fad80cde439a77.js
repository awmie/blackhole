"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[824],{5824:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});var n=r(5155),i=r(2115);let o=Math.PI/16384,l={uniforms:{tDiffuse:{value:null},resolution:{value:null},bhPos:{value:null},bhRadius:{value:0},mass:{value:0}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform vec2 resolution;\n    uniform vec2 bhPos;\n    uniform float bhRadius;\n    uniform float mass;\n    varying vec2 vUv;\n    \n    void main() {\n      vec2 aspectUv = vUv * vec2(resolution.x / resolution.y, 1.0);\n      vec2 aspectBh = bhPos * vec2(resolution.x / resolution.y, 1.0);\n      \n      vec2 toBh = aspectBh - aspectUv;\n      float dist = length(toBh);\n      \n      // Lensing pull strength\n      float pull = (mass / 10.0) * bhRadius * bhRadius / max(dist, 0.001);\n      \n      vec2 offset = normalize(toBh) * pull;\n      offset.x /= resolution.x / resolution.y;\n      \n      vec4 color = texture2D(tDiffuse, vUv + offset);\n      \n      // Black hole shadow\n      if (dist < bhRadius) {\n        color = vec4(0.0, 0.0, 0.0, 1.0);\n      }\n      \n      gl_FragColor = color;\n    }\n  "},a=e=>{let{blackHoleRadius:t,accretionDiskInnerRadius:a,accretionDiskOuterRadius:c,accretionDiskOpacity:u,onCameraUpdate:s,spawnedPlanets:d,onAbsorbPlanet:f,onSetPlanetDissolving:m,isEmittingJets:p,onCameraReady:v,onShiftClickSpawnAtPoint:h,onStarMassLoss:y,onUpdatePlanetPosition:g,collisionEvents:w,onCollisionEventProcessed:M,simulationSpeed:b}=e,x=(0,i.useRef)(null),z=(0,i.useRef)(null),R=(0,i.useRef)(null),S=(0,i.useRef)(null),P=(0,i.useRef)(null),A=(0,i.useRef)(null),E=(0,i.useRef)(null),C=(0,i.useRef)(null),V=(0,i.useRef)(null),F=(0,i.useRef)(null),B=(0,i.useRef)(null),L=(0,i.useRef)(null),D=(0,i.useRef)([]),_=(0,i.useRef)(null),U=(0,i.useRef)([]),T=(0,i.useRef)(new Map),k=(0,i.useRef)(new Map),q=(0,i.useRef)(new Map),G=(0,i.useRef)(null),H=(0,i.useRef)([]),W=(0,i.useRef)(null),j=(0,i.useRef)(0),I=(0,i.useRef)(null),Y=(0,i.useRef)([]),N=(0,i.useRef)(null),K=(0,i.useRef)(0),Q=(0,i.useRef)(null),X=(0,i.useRef)([]),J=(0,i.useRef)(null),O=(0,i.useRef)(0),Z=(0,i.useRef)(null),$=(0,i.useRef)(null),ee=(0,i.useRef)(null),et=(0,i.useRef)(null),er=(0,i.useRef)(null),en=(0,i.useRef)(h),ei=(0,i.useRef)(s),eo=(0,i.useRef)(f),el=(0,i.useRef)(m),ea=(0,i.useRef)(y),ec=(0,i.useRef)(g),eu=(0,i.useRef)(w),es=(0,i.useRef)(M),ed=(0,i.useRef)(d);(0,i.useEffect)(()=>{ed.current=d},[d]);let ef=(0,i.useRef)(p);(0,i.useEffect)(()=>{ef.current=p},[p]);let em=(0,i.useRef)(t);(0,i.useEffect)(()=>{em.current=t},[t]);let ep=(0,i.useRef)(b);(0,i.useEffect)(()=>{ep.current=b},[b]),(0,i.useEffect)(()=>{en.current=h},[h]),(0,i.useEffect)(()=>{ei.current=s},[s]),(0,i.useEffect)(()=>{eo.current=f},[f]),(0,i.useEffect)(()=>{el.current=m},[m]),(0,i.useEffect)(()=>{ea.current=y},[y]),(0,i.useEffect)(()=>{ec.current=g},[g]),(0,i.useEffect)(()=>{eu.current=w},[w]),(0,i.useEffect)(()=>{es.current=M},[M]);let ev=(0,i.useCallback)((e,t,r)=>{let n=er.current,i=R.current;if(!n||!i)return;B.current&&(i.remove(B.current),B.current.geometry.dispose(),B.current.material.dispose(),B.current=null);let o=new n.BufferGeometry,l=new Float32Array(75e3),a=new Float32Array(1e5);U.current=[];let c=new n.Color(1,.4,.8),u=new n.Color(.6,.3,.9),s=new n.Color(.2,.1,.7),d=new n.Color(1,.95,.85);for(let i=0;i<25e3;i++){let o=3*i,f=4*i,m=Math.random()*(t-e)+e,p=Math.random()*Math.PI*2,v=(Math.random()-.5)*.1,h=(m-e)/(t-e);h=Math.max(0,Math.min(1,h));let y=+Math.pow(e/m,2.5);y=Math.max(y,.02),U.current.push({radius:m,angle:p,angularVelocity:y,yOffset:v}),l[o]=m*Math.cos(p),l[o+1]=v,l[o+2]=m*Math.sin(p);let g=new n.Color;if(h<.5?g.lerpColors(c,u,2*h):g.lerpColors(u,s,(h-.5)*2),h<.03){let e=(.03-h)/.03;e=Math.pow(e,1.5),g.lerp(d,e),g.r=Math.min(1,g.r+2.5*e),g.g=Math.min(1,g.g+2.5*e),g.b=Math.min(1,g.b+2.5*e)}else{let e=1-Math.min(1,Math.max(0,(h-.03)/.15));e>0&&(g.r=Math.min(1,g.r+.8*e),g.g=Math.min(1,g.g+.8*e),g.b=Math.min(1,g.b+.8*e))}a[f]=g.r,a[f+1]=g.g,a[f+2]=g.b;let w=r;h>.7&&(w*=1-(h-.7)/.30000000000000004),a[f+3]=Math.max(0,Math.min(1,w))}o.setAttribute("position",new n.BufferAttribute(l,3)),o.setAttribute("color",new n.BufferAttribute(a,4));let f=new n.PointsMaterial({size:.01,vertexColors:!0,transparent:!0,blending:n.AdditiveBlending,depthWrite:!1,sizeAttenuation:!0}),m=new n.Points(o,f);i.add(m),B.current=m},[]),eh=(0,i.useCallback)(()=>{let e=er.current,t=R.current;if(!e||!t)return;G.current&&(t.remove(G.current),G.current.geometry.dispose(),G.current.material instanceof e.Material&&G.current.material.dispose(),G.current=null);let r=new e.BufferGeometry,n=new Float32Array(3e4),i=new Float32Array(3e4),o=new Float32Array(1e4);H.current=[];for(let t=0;t<1e4;t++)H.current.push({id:t,position:new e.Vector3(0,-1e3,0),velocity:new e.Vector3,life:0,initialLife:4,color:new e.Color(1,1,1),size:.003,active:!1}),n[3*t]=0,n[3*t+1]=-1e3,n[3*t+2]=0,i[3*t]=1,i[3*t+1]=1,i[3*t+2]=1,o[t]=.003;r.setAttribute("position",new e.Float32BufferAttribute(n,3)),r.setAttribute("color",new e.Float32BufferAttribute(i,3)),r.setAttribute("size",new e.Float32BufferAttribute(o,1)),r.frustumCulled=!1,W.current=new e.PointsMaterial({vertexColors:!0,transparent:!0,blending:e.AdditiveBlending,depthWrite:!1,sizeAttenuation:!0}),G.current=new e.Points(r,W.current),G.current.visible=!0,G.current.frustumCulled=!1,t.add(G.current),j.current=0},[]),ey=(0,i.useCallback)(()=>{let e=er.current,t=R.current;if(!e||!t)return;I.current&&(t.remove(I.current),I.current.geometry.dispose(),I.current.material instanceof e.Material&&I.current.material.dispose(),I.current=null);let r=new e.BufferGeometry,n=new Float32Array(3e4),i=new Float32Array(3e4),o=new Float32Array(1e4);r.frustumCulled=!1,Y.current=[];for(let t=0;t<1e4;t++){Y.current.push({id:t,position:new e.Vector3(0,-1e3,0),velocity:new e.Vector3,life:0,initialLife:1.5,color:new e.Color(1,1,1),size:5e-4,active:!1});let r=3*t;n[r]=0,n[r+1]=-1e3,n[r+2]=0,i[r]=1,i[r+1]=1,i[r+2]=1,o[t]=5e-4}r.setAttribute("position",new e.Float32BufferAttribute(n,3)),r.setAttribute("color",new e.Float32BufferAttribute(i,3)),r.setAttribute("size",new e.Float32BufferAttribute(o,1)),N.current=new e.PointsMaterial({vertexColors:!0,transparent:!0,blending:e.AdditiveBlending,depthWrite:!1,sizeAttenuation:!0}),I.current=new e.Points(r,N.current),I.current.visible=!0,I.current.frustumCulled=!1,t.add(I.current),K.current=0},[]),eg=(0,i.useCallback)(()=>{let e=er.current,t=R.current;if(!e||!t)return;Q.current&&(t.remove(Q.current),Q.current.geometry.dispose(),Q.current.material instanceof e.Material&&Q.current.material.dispose(),Q.current=null);let r=new e.BufferGeometry,n=new Float32Array(15e3),i=new Float32Array(15e3),o=new Float32Array(5e3);r.frustumCulled=!1,X.current=[];for(let t=0;t<5e3;t++)X.current.push({id:t,position:new e.Vector3(0,-1e3,0),velocity:new e.Vector3,life:0,initialLife:1,color:new e.Color(1,1,1),size:.01,active:!1}),n[3*t]=0,n[3*t+1]=-1e3,n[3*t+2]=0,i[3*t]=1,i[3*t+1]=1,i[3*t+2]=1,o[t]=.01;r.setAttribute("position",new e.Float32BufferAttribute(n,3)),r.setAttribute("color",new e.Float32BufferAttribute(i,3)),r.setAttribute("size",new e.Float32BufferAttribute(o,1)),J.current=new e.PointsMaterial({vertexColors:!0,transparent:!0,blending:e.AdditiveBlending,depthWrite:!1,sizeAttenuation:!0}),Q.current=new e.Points(r,J.current),Q.current.visible=!0,Q.current.frustumCulled=!1,t.add(Q.current),O.current=0},[]);return(0,i.useEffect)(()=>{R.current&&er.current&&(eh(),ey(),eg())},[eh,ey,eg]),(0,i.useEffect)(()=>{let e;if(!x.current)return;er.current=r(8736);let t=er.current;if(!t)return;$.current=new t.Vector3,ee.current=new t.Vector3,et.current=new t.Quaternion;let{OrbitControls:n}=r(5416),{EffectComposer:i}=r(8154),{RenderPass:s}=r(8446),{ShaderPass:d}=r(6555);_.current||(_.current=new t.Clock),R.current=new t.Scene,S.current=new t.Scene;let f=new t.PerspectiveCamera(75,x.current.clientWidth/x.current.clientHeight,.1,1e3);f.position.set(0,1.5*em.current,4*em.current),P.current=f,v&&v(f),ei.current&&ei.current({x:f.position.x,y:f.position.y,z:f.position.z});let m=new t.WebGLRenderer({antialias:!0});m.setSize(x.current.clientWidth,x.current.clientHeight),m.setPixelRatio(window.devicePixelRatio),m.autoClear=!1,x.current.appendChild(m.domElement),z.current=m;let p=new i(m);E.current=p;let h=new s(S.current,f);p.addPass(h);let y=new d(l);y.uniforms.resolution.value=new t.Vector2(x.current.clientWidth*window.devicePixelRatio,x.current.clientHeight*window.devicePixelRatio),y.uniforms.bhPos.value=new t.Vector2(.5,.5),C.current=y,p.addPass(y),Z.current=new t.WebGLRenderTarget(x.current.clientWidth*window.devicePixelRatio,x.current.clientHeight*window.devicePixelRatio),Z.current&&(Z.current.texture.minFilter=t.LinearFilter,Z.current.texture.magFilter=t.LinearFilter,Z.current.texture.wrapS=t.ClampToEdgeWrapping,Z.current.texture.wrapT=t.ClampToEdgeWrapping);let g=new n(f,m.domElement);g.enableDamping=!0,g.dampingFactor=.05,g.screenSpacePanning=!1,g.minDistance=1.2*em.current,g.maxDistance=80,A.current=g,g.addEventListener("change",()=>{P.current&&ei.current&&ei.current({x:P.current.position.x,y:P.current.position.y,z:P.current.position.z})});let w=new t.SphereGeometry(1,64,64);F.current=new t.ShaderMaterial({vertexShader:"\nvarying vec3 v_worldPosition;\nvarying vec3 v_normal;\nvarying vec4 v_screenPosition; \n\nvoid main() {\n  vec4 worldPos = modelMatrix * vec4(position, 1.0);\n  v_worldPosition = worldPos.xyz;\n  v_normal = normalize(mat3(modelMatrix) * normal);\n  \n  v_screenPosition = projectionMatrix * modelViewMatrix * vec4(position, 1.0); \n  \n  gl_Position = v_screenPosition;\n}\n",fragmentShader:"\nvarying vec3 v_worldPosition;\nvarying vec3 v_normal;\nvarying vec4 v_screenPosition;\n\nuniform vec3 u_cameraPosition;\n\nvoid main() {\n  // Simple black hole - just black with fresnel edge\n  vec3 normal = normalize(v_normal);\n  vec3 viewDir = normalize(u_cameraPosition - v_worldPosition);\n  float fresnel = pow(1.0 - abs(dot(normal, viewDir)), 2.0);\n  \n  gl_FragColor = vec4(vec3(0.0), 1.0);\n}\n",uniforms:{u_cameraPosition:{value:f.position}}});let M=new t.Mesh(w,F.current);M.position.set(0,0,0),R.current.add(M),V.current=M,ev(a,c,u);let b=new t.BufferGeometry,J=[],ea=[];D.current=[];for(let e=0;e<2e4;e++){let e=200+600*Math.random(),t=Math.random()*Math.PI*2,r=Math.random()*Math.PI;J.push(e*Math.sin(r)*Math.cos(t),e*Math.sin(r)*Math.sin(t),e*Math.cos(r));let n=.7+.4*Math.random();ea.push(n),D.current.push({initialSize:n,phase:Math.random()*Math.PI*2,speed:.3+.7*Math.random()})}b.setAttribute("position",new t.Float32BufferAttribute(J,3)),b.setAttribute("size",new t.Float32BufferAttribute(ea,1));let ew=new t.PointsMaterial({color:0xffffff,sizeAttenuation:!0});L.current=new t.Points(b,ew),S.current.add(L.current);let eM=new t.AmbientLight(0xffffff,.6);R.current.add(eM);let eb=new t.DirectionalLight(0xffffff,1);eb.position.set(5,10,7.5),R.current.add(eb),G.current||eh(),I.current||ey(),Q.current||eg();let ex=m.domElement,ez=e=>{let t=er.current;if(!e.shiftKey||!P.current||!en.current||!t)return;e.preventDefault(),e.stopPropagation();let r=ex.getBoundingClientRect(),n=new t.Vector2;n.x=(e.clientX-r.left)/r.width*2-1,n.y=-(2*((e.clientY-r.top)/r.height))+1;let i=new t.Raycaster;i.setFromCamera(n,P.current);let o=new t.Plane(new t.Vector3(0,1,0),0),l=new t.Vector3;i.ray.intersectPlane(o,l)&&en.current(l)};ex.addEventListener("pointerdown",ez);let eR=()=>{var t,r,n,i,l,a,c;e=requestAnimationFrame(eR);let u=er.current,s=z.current,d=R.current,f=S.current,m=P.current,p=Z.current,v=F.current,h=V.current,y=$.current,g=ee.current,w=et.current;if(!_.current||!u||!s||!d||!f||!m||!p||!v||!h||!y||!g||!w)return;let M=_.current.getDelta(),b=_.current.getElapsedTime(),x=M*ep.current;if(null==(t=A.current)||t.update(),v.uniforms.u_cameraPosition.value.copy(m.position),C.current){let e=C.current,t=h.position.clone(),r=t.project(m),n=(r.x+1)/2,i=(r.y+1)/2,o=t.clone().add(new u.Vector3(em.current,0,0)).project(m),l=Math.sqrt(Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2))/2;e.uniforms.bhPos.value.set(n,i),e.uniforms.bhRadius.value=l,e.uniforms.mass.value=10*em.current}if(null==(r=B.current)?void 0:r.geometry){let e=B.current.geometry.attributes.position.array;for(let t=0;t<U.current.length;t++){let r=U.current[t];r.angle+=r.angularVelocity*x;let n=3*t;e[n]=r.radius*Math.cos(r.angle),e[n+2]=r.radius*Math.sin(r.angle)}B.current.geometry.attributes.position.needsUpdate=!0}if(null==(n=L.current)?void 0:n.geometry){let e=L.current.geometry.attributes.size,t=D.current;if(e&&2e4===t.length){for(let r=0;r<2e4;r++){let n=t[r],i=.6+.4*Math.sin(b*n.speed+n.phase);e.array[r]=n.initialSize*Math.max(.1,i)}e.needsUpdate=!0}}if(ed.current.forEach(e=>{var t;let r=T.current.get(e.id),n=q.current.get(e.id);if(!r||!n)return;n.ttl-=M;let i=em.current,o=null!=(t="star"===e.type?e.currentMassFactor:1)?t:1;if(e.isDissolving){let t=k.current.get(e.id)||0;t+=M/(e.timeToLive>0?e.timeToLive:1.5),t=Math.min(t,1),k.current.set(e.id,t);let l=1-t;if(r.scale.set(e.initialScale.x*o*l,e.initialScale.y*o*l,e.initialScale.z*o*l),y.copy(h.position).sub(n.position).normalize(),n.velocity.addScaledVector(y,8*i*x*(.5+1.5*t)),n.position.addScaledVector(n.velocity,x),"star"===e.type&&I.current&&Y.current.length>0&&r){let t=new u.Color(e.color);for(let e=0;e<2;e++){let e=K.current,n=Y.current[e];if(n&&!n.active){n.active=!0,n.position.copy(r.position);let e=new u.Vector3(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize();n.velocity.copy(e).multiplyScalar(.3),n.life=1,n.initialLife=1.5+.1*Math.random(),n.color.copy(t),n.size=(5e-4+5e-4*Math.random())*Math.min(1,.5*o+.5)}K.current=(e+1)%1e4}}(t>=1||n.position.lengthSq()<i*i*.01)&&(eo.current&&eo.current(e.id),q.current.delete(e.id),k.current.delete(e.id))}else{let t=g.set(0,0,0),r="star"===e.type?150*o:.5*(e.initialScale.x/.1);y.copy(h.position).sub(n.position);let l=y.lengthSq();l=Math.max(l,.01+i*i);let a=200*i*.05*r/l;t.addScaledVector(y.normalize(),a/r),ed.current.forEach(i=>{if(i.id!==e.id&&"star"===i.type&&!i.isDissolving){let e=T.current.get(i.id),o=q.current.get(i.id);if(e&&o){let e=150*(i.currentMassFactor||1);y.copy(o.position).sub(n.position);let l=y.lengthSq(),a=.05*e*r/(l=Math.max(l,.01));t.addScaledVector(y.normalize(),a/r)}}}),n.velocity.addScaledVector(t,x),n.position.addScaledVector(n.velocity,x),n.position.lengthSq()<1.2*i*i*1.2&&el.current?el.current(e.id,!0):(n.ttl<=0||n.position.lengthSq()<i*i*.01)&&(eo.current&&eo.current(e.id),q.current.delete(e.id),k.current.delete(e.id))}r.position.copy(n.position),r.scale.set(e.initialScale.x*o*(e.isDissolving?1-(k.current.get(e.id)||0):1),e.initialScale.y*o*(e.isDissolving?1-(k.current.get(e.id)||0):1),e.initialScale.z*o*(e.isDissolving?1-(k.current.get(e.id)||0):1)),n.velocity.lengthSq()>.001&&!e.isDissolving?(y.copy(n.position).add(n.velocity),r.lookAt(y)):e.isDissolving&&r.quaternion.slerp(w.setFromUnitVectors(new u.Vector3(0,0,1),new u.Vector3(0,0,1)),.1),ec.current&&ec.current(e.id,{x:n.position.x,y:n.position.y,z:n.position.z},{x:n.velocity.x,y:n.velocity.y,z:n.velocity.z})}),(null==(i=I.current)?void 0:i.geometry)&&N.current&&Y.current.length>0&&u){let e=I.current.geometry.attributes.position.array,t=I.current.geometry.attributes.color.array,r=I.current.geometry.attributes.size.array,n=!1;Y.current.forEach((i,o)=>{if(i.active&&i.life>0){n=!0,y.copy(h.position).sub(i.position);let l=Math.max(.1,i.position.lengthSq());y.normalize().multiplyScalar(.5/l),i.velocity.addScaledVector(y,x),i.position.addScaledVector(i.velocity,x),i.life-=M/i.initialLife;let a=3*o;e[a]=i.position.x,e[a+1]=i.position.y,e[a+2]=i.position.z;let c=Math.max(0,i.life);t[a]=i.color.r*c,t[a+1]=i.color.g*c,t[a+2]=i.color.b*c,r[o]=i.size*c,(i.life<=0||i.position.lengthSq()<em.current*em.current*.01)&&(i.active=!1,e[a+1]=-1e3)}else!1===i.active&&e[3*o+1]>-999&&(e[3*o+1]=-1e3,n=!0)}),n&&(I.current.geometry.attributes.position.needsUpdate=!0,I.current.geometry.attributes.color.needsUpdate=!0,I.current.geometry.attributes.size.needsUpdate=!0)}if((null==(l=G.current)?void 0:l.geometry)&&W.current&&H.current.length>0&&u){let e=G.current.geometry.attributes.position.array,t=G.current.geometry.attributes.color.array,r=G.current.geometry.attributes.size.array,n=!1;if(ef.current)for(let t of(n=!0,[1,-1]))for(let r=0;r<150;r++){let r=j.current,n=H.current[r];if(n&&!n.active){n.active=!0,n.position.set(0,t*em.current*1.05,0);let i=Math.random()*Math.PI*2,l=Math.random()*o-o/2,a=new u.Vector3(Math.sin(l)*Math.cos(i),Math.cos(l)*t,Math.sin(l)*Math.sin(i)),c=new u.Vector3(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar(5e-4);a.add(c).normalize(),n.velocity.copy(a).multiplyScalar(6*(.7+.6*Math.random())),n.life=1,n.initialLife=4*(.6+.8*Math.random()),n.color.setHSL(.15*Math.random()+.5,.95,.85),n.size=.003,e[3*r]=n.position.x,e[3*r+1]=n.position.y,e[3*r+2]=n.position.z,j.current=(r+1)%1e4}else if(n&&n.active)break}H.current.forEach((i,o)=>{let l=3*o;if(i.active&&i.life>0){n=!0,i.position.addScaledVector(i.velocity,x),i.life-=M/i.initialLife,e[l]=i.position.x,e[l+1]=i.position.y,e[l+2]=i.position.z;let a=Math.max(0,i.life);t[l]=i.color.r*a,t[l+1]=i.color.g*a,t[l+2]=i.color.b*a,r[o]=i.size*a,i.life<=0&&(i.active=!1,e[l+1]=-1e3)}else!i.active&&e[l+1]>-999&&(e[l+1]=-1e3,n=!0)}),G.current.visible=!0,n&&(G.current.geometry.attributes.position.needsUpdate=!0,G.current.geometry.attributes.color.needsUpdate=!0,G.current.geometry.attributes.size.needsUpdate=!0)}if(eu.current.length>0&&(null==(a=Q.current)?void 0:a.geometry)&&u&&eu.current.forEach(e=>{let t=new u.Vector3(e.point.x,e.point.y,e.point.z),r=new u.Color(e.color1),n=new u.Color(e.color2);for(let e=0;e<75;e++){let e=O.current,i=X.current[e];i&&!i.active&&(i.active=!0,i.position.copy(t),i.velocity.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar(.5+2*Math.random()),i.initialLife=.8+ +Math.random(),i.life=1,i.color.copy(Math.random()>.5?r:n),i.size=8e-4+.0012000000000000001*Math.random()),O.current=(e+1)%5e3}es.current&&es.current(e.id)}),(null==(c=Q.current)?void 0:c.geometry)&&X.current.length>0&&u&&$.current){let e=Q.current.geometry.attributes.position.array,t=Q.current.geometry.attributes.color.array,r=Q.current.geometry.attributes.size.array,n=!1,i=em.current;X.current.forEach((o,l)=>{let a=3*l;if(o.active&&o.life>0){n=!0;let c=o.position.lengthSq(),u=.02,s=4*i,d=1.1*i;if(c<s*s&&(u*=25,$.current)){let e=$.current.set(-o.position.z,0,o.position.x).normalize(),t=.3*Math.max(0,1-Math.sqrt(c)/s)*u*x*.1;o.velocity.addScaledVector(e,t)}let f=$.current.copy(o.position).negate(),m=1/Math.max(.01,c);f.normalize().multiplyScalar(u*i*m),o.velocity.addScaledVector(f,x),o.position.addScaledVector(o.velocity,x);let p=1;c<d*d&&(p=8),o.life-=M/o.initialLife*p,e[a]=o.position.x,e[a+1]=o.position.y,e[a+2]=o.position.z;let v=Math.max(0,o.life);t[a]=o.color.r*v,t[a+1]=o.color.g*v,t[a+2]=o.color.b*v,r[l]=o.size*v,(o.life<=0||c<i*i*.9)&&(o.active=!1,e[a+1]=-1e3)}else!o.active&&e[a+1]>-999&&(e[a+1]=-1e3,n=!0)}),n&&(Q.current.geometry.attributes.position.needsUpdate=!0,Q.current.geometry.attributes.color.needsUpdate=!0,Q.current.geometry.attributes.size.needsUpdate=!0)}E.current&&E.current.render()};eR();let eS=()=>{if(x.current&&P.current&&z.current&&E.current&&C.current){let e=x.current.clientWidth,t=x.current.clientHeight;P.current.aspect=e/t,P.current.updateProjectionMatrix(),z.current.setSize(e,t),E.current.setSize(e,t),C.current.uniforms.resolution.value.set(e*window.devicePixelRatio,t*window.devicePixelRatio)}};return window.addEventListener("resize",eS),()=>{var t,r,n,i;window.removeEventListener("resize",eS),ex&&ex.removeEventListener("pointerdown",ez),A.current&&A.current.dispose(),E.current&&E.current.dispose(),cancelAnimationFrame(e),T.current.forEach(e=>{var t,r;null==(t=R.current)||t.remove(e),e instanceof THREE_TYPE.Group?e.traverse(e=>{if(e instanceof THREE_TYPE.Mesh){var t,r;null==(t=e.geometry)||t.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):null==(r=e.material)||r.dispose()}}):e instanceof THREE_TYPE.Mesh&&(null==(r=e.geometry)||r.dispose(),e.material&&e.material.dispose())}),T.current.clear(),k.current.clear(),q.current.clear(),D.current=[];let o=e=>{let t=er.current;if(e.current){var r;e.current.geometry.dispose(),t&&e.current.material instanceof t.Material&&e.current.material.dispose(),null==(r=R.current)||r.remove(e.current),e.current=null}};o(G),o(I),o(Q),null==(t=Z.current)||t.dispose(),null==(r=R.current)||r.traverse(e=>{let t=er.current;if(t&&(e instanceof t.Mesh||e instanceof t.Points||e instanceof t.LineSegments)){e.geometry&&e.geometry.dispose();let t=e.material;t&&(Array.isArray(t)?t.forEach(e=>e.dispose()):t.dispose())}}),null==(n=S.current)||n.traverse(e=>{let t=er.current;t&&e instanceof t.Points&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose())}),x.current&&z.current&&x.current.removeChild(z.current.domElement),null==(i=z.current)||i.dispose(),U.current=[],er.current=null}},[]),(0,i.useEffect)(()=>{if(V.current&&V.current.scale.set(em.current,em.current,em.current),A.current&&(A.current.minDistance=1.2*em.current),P.current&&P.current.position.length()<1.2*em.current){let e=P.current.position.clone().normalize().multiplyScalar(1.2*em.current);P.current.position.copy(e),ei.current&&ei.current({x:e.x,y:e.y,z:e.z})}},[t]),(0,i.useEffect)(()=>{R.current&&er.current&&ev(a,c,u)},[a,c,u,ev]),(0,i.useEffect)(()=>{let e=R.current,t=er.current;if(!e||!t)return;let r=new Set(Array.from(T.current.keys())),n=new Set(d.map(e=>e.id));d.forEach(r=>{var n;let i=T.current.get(r.id),o=null!=(n="star"===r.type?r.currentMassFactor:1)?n:1;if(i){let e=q.current.get(r.id);if(e){if("star"===r.type&&i instanceof t.Group){let e=i.children.find(e=>e instanceof t.Mesh);e&&e.material instanceof t.MeshBasicMaterial&&e.material.color.getHexString()!==new t.Color(r.color).getHexString()&&e.material.color.set(r.color)}else"planet"===r.type&&i instanceof t.Mesh&&i.material instanceof t.MeshStandardMaterial&&i.material.color.getHexString()!==new t.Color(r.color).getHexString()&&i.material.color.set(r.color);r.isDissolving&&e.ttl>r.timeToLive?e.ttl=r.timeToLive:r.isDissolving||e.ttl===r.timeToLive||(e.ttl=r.timeToLive),i.scale.set(r.initialScale.x*o*(r.isDissolving?1-(k.current.get(r.id)||0):1),r.initialScale.y*o*(r.isDissolving?1-(k.current.get(r.id)||0):1),r.initialScale.z*o*(r.isDissolving?1-(k.current.get(r.id)||0):1))}}else{let n,l=new t.SphereGeometry(1,16,16);if("star"===r.type){let e=new t.Group;n=new t.MeshBasicMaterial({color:r.color});let o=new t.Mesh(l,n);e.add(o),i=e}else n=new t.MeshStandardMaterial({color:r.color,roughness:.5,metalness:.1}),i=new t.Mesh(l,n);i.position.set(r.position.x,r.position.y,r.position.z),i.scale.set(r.initialScale.x*o,r.initialScale.y*o,r.initialScale.z*o),e.add(i),T.current.set(r.id,i),i.userData={objectId:r.id},q.current.set(r.id,{id:r.id,position:new t.Vector3(r.position.x,r.position.y,r.position.z),velocity:new t.Vector3(r.velocity.x,r.velocity.y,r.velocity.z),ttl:r.timeToLive})}}),r.forEach(r=>{if(!n.has(r)){let n=T.current.get(r);if(n){if(e.remove(n),n instanceof t.Group)n.traverse(e=>{if(e instanceof t.Mesh){var r,n;null==(r=e.geometry)||r.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):null==(n=e.material)||n.dispose()}});else if(n instanceof t.Mesh){var i;null==(i=n.geometry)||i.dispose(),n.material&&n.material.dispose()}T.current.delete(r)}q.current.delete(r),k.current.delete(r)}})},[d]),(0,n.jsx)("div",{ref:x,className:"w-full h-full outline-none","data-ai-hint":"galaxy space"})}}}]);